(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{127:function(e,v,_){"use strict";_.r(v);var p=_(0),r=Object(p.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var e=this,v=e.$createElement,_=e._self._c||v;return _("div",{staticClass:"content"},[_("h1",{attrs:{id:"用-node-js-的-16-行代码创建一个简单的天气-app"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#用-node-js-的-16-行代码创建一个简单的天气-app","aria-hidden":"true"}},[e._v("#")]),e._v(" 用 Node.js 的 16 行代码创建一个简单的天气 App")]),e._v(" "),_("p",[e._v("景朝阳 [AutoCFE](javascript:void(0)😉 "),_("em",[e._v("2017-09-01")])]),e._v(" "),_("p",[e._v("原文地址：https://codeburst.io/build-a-simple-weather-app-with-node-js-in-just-16-lines-of-code-32261690901d")]),e._v(" "),_("p",[e._v("仅15分钟学会使用 API 调用并建立一个命令行天气应用程序。")]),e._v(" "),_("p",[e._v("本教程的范围")]),e._v(" "),_("p",[e._v("欢迎！这是多篇教程中的第一篇文章！")]),e._v(" "),_("p",[e._v("在本教程中,您将学习如何调")]),e._v(" "),_("p",[e._v("用 OpenWeatherMap.org API 并把结果输出到控制台。")]),e._v(" "),_("p",[e._v("- 20 秒快速注册 OpenWeatherMap.org 账户。")]),e._v(" "),_("p",[e._v("- Node.js : 如果没有安装 Node，请到官网 Node.js website 下载并安装。如果这样的项目你感兴趣并且你也在寻找 Node 更深入的教程请查看另一篇文章 Top Three Node.js courses")]),e._v(" "),_("p",[e._v("第一步：OpenWeatherMap")]),e._v(" "),_("p",[e._v("当你想玩玩 API ，OpenWeatherMap 是一个不错的地方。实际上有关于天气的11种不同的api供您访问。")]),e._v(" "),_("p",[e._v("对于这个项目我们将使用免费的 Current Weather API, 点击此处注册账号。")]),e._v(" "),_("p",[e._v("登陆之后， 点击 API keys, 在页面的右侧你可以创建一个 key，输入一个名称(任何)并选择生成。在页面左侧可以看到生成的 API Key。")]),e._v(" "),_("p",[_("img",{attrs:{src:"https://mmbiz.qpic.cn/mmbiz_png/gb0VkRWbm2PyX0Yic6WOSciciaibUe1K1tOdNuU6ANS5l6IUupKxOwibMvaWicKNlvpBN5Mxc3v5RLHMKAiboYahZlorw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1",alt:"img"}})]),e._v(" "),_("p",[e._v("太棒了,现在我们有API密匙，可以开始创建我们的应用程序。")]),e._v(" "),_("p",[e._v("第二步：Setting up the project")]),e._v(" "),_("p",[e._v("\\1. 创建 node-weather 文件夹然后执行：")]),e._v(" "),_("p",[e._v("npm init")]),e._v(" "),_("p",[e._v("\\2. 填写所需的信息来初始化我们的项目")]),e._v(" "),_("p",[e._v("以下是我的 package.json 文件初始化后的样子。")]),e._v(" "),_("p",[e._v("注意:你本地的跟我的看起来略有不同,没关系。")]),e._v(" "),_("p",[e._v("{")]),e._v(" "),_("p",[e._v('"name": "simple-nodejs-weather-app",')]),e._v(" "),_("p",[e._v('"version": "1.0.0",')]),e._v(" "),_("p",[e._v('"description": "",')]),e._v(" "),_("p",[e._v('"main": "index.js",')]),e._v(" "),_("p",[e._v('"scripts": {')]),e._v(" "),_("p",[e._v('​    "test": "echo "Error: no test specified" && exit 1"')]),e._v(" "),_("p",[e._v("},")]),e._v(" "),_("p",[e._v('"repository": {')]),e._v(" "),_("p",[e._v('​    "type": "git",')]),e._v(" "),_("p",[e._v('​    "url": "git+https://github.com/bmorelli25/simple-nodejs-weather-app.git"')]),e._v(" "),_("p",[e._v("},")]),e._v(" "),_("p",[e._v('"author": "brandon morelli",')]),e._v(" "),_("p",[e._v('"license": "ISC",')]),e._v(" "),_("p",[e._v('"bugs": {')]),e._v(" "),_("p",[e._v('​    "url": "https://github.com/bmorelli25/simple-nodejs-weather-app/issues"')]),e._v(" "),_("p",[e._v("},")]),e._v(" "),_("p",[e._v('"homepage": "https://github.com/bmorelli25/simple-nodejs-weather-app#readme",')]),e._v(" "),_("p",[e._v('"dependencies": {')]),e._v(" "),_("p",[e._v("}")]),e._v(" "),_("p",[e._v("}")]),e._v(" "),_("p",[e._v("\\3.  创建 index.js 文件，此文件将包含应用程序的代码。")]),e._v(" "),_("p",[e._v("Making the API call")]),e._v(" "),_("p",[e._v("API调用，我们将使用一个受欢迎的npm模块 request 调用。 request 已经有数以百万的下载，是一个简化 http 请求的模块。")]),e._v(" "),_("p",[e._v("npm install request --save")]),e._v(" "),_("p",[e._v("就像我说的, request 很容易使用。我们只需要传惨 url，request 返回一个回调函数。")]),e._v(" "),_("p",[e._v("const request = require('request');")]),e._v(" "),_("p",[e._v("request(url, function (err, response, body) {")]),e._v(" "),_("p",[e._v("if(err){")]),e._v(" "),_("p",[e._v("​    console.log('error:', error);")]),e._v(" "),_("p",[e._v("} else {")]),e._v(" "),_("p",[e._v("​    console.log('body:', body);")]),e._v(" "),_("p",[e._v("}")]),e._v(" "),_("p",[e._v("});")]),e._v(" "),_("p",[e._v("让我们分解这个代码")]),e._v(" "),_("p",[e._v("\\1. 引入 request 包")]),e._v(" "),_("p",[e._v("\\2. 传 url ，request 返回一个回调函数，其中参数为 err 、 response 、body")]),e._v(" "),_("p",[e._v("\\3. 在请求中检查错误， 如果有 error ，输出到控制台")]),e._v(" "),_("p",[e._v("\\4. 如果没有 error, 将 body 输出。")]),e._v(" "),_("p",[e._v("太棒啦，不过 url 是什么呢？")]),e._v(" "),_("p",[e._v("通过阅读OpenWeatherMap(https://openweathermap.org/current)  文档，能够确定 url 是什么。http://api.openweathermap.org/data/2.5/weather 需要两个必须的参数。已键值对形式通过 url 传递城市以及 API Key 。")]),e._v(" "),_("p",[e._v("let apiKey = '****************************';")]),e._v(" "),_("p",[e._v("let city = 'portland';")]),e._v(" "),_("p",[e._v("let url = "),_("code",[e._v("http://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiKey}")])]),e._v(" "),_("p",[e._v("上述代码做了3件事")]),e._v(" "),_("p",[e._v("\\1. 声明变量 apiKey 存放 API Key")]),e._v(" "),_("p",[e._v("\\2. 声明变量  city 存放城市。")]),e._v(" "),_("p",[e._v("\\3. 声明变量 url 存放接口地址，? 后面是查询参数，以 key = value 形式存在，不同参数间以 & 连接")]),e._v(" "),_("p",[e._v("代码整合后如下：")]),e._v(" "),_("p",[e._v("let request = require('request');")]),e._v(" "),_("p",[e._v("let apiKey = '*****************************';")]),e._v(" "),_("p",[e._v("let city = 'portland';")]),e._v(" "),_("p",[e._v("let url = "),_("code",[e._v("http://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiKey}")])]),e._v(" "),_("p",[e._v("request(url, function (err, response, body) {")]),e._v(" "),_("p",[e._v("if(err){")]),e._v(" "),_("p",[e._v("​    console.log('error:', error);")]),e._v(" "),_("p",[e._v("} else {")]),e._v(" "),_("p",[e._v("​    console.log('body:', body);")]),e._v(" "),_("p",[e._v("}")]),e._v(" "),_("p",[e._v("});")]),e._v(" "),_("p",[e._v("控制台输入运行代码：")]),e._v(" "),_("p",[e._v("node index.js")]),e._v(" "),_("p",[e._v("// the following is returned:")]),e._v(" "),_("p",[e._v('body: {"coord":{"lon":-122.68,"lat":45.52},"weather":  [{"id":801,"main":"Clouds","description":"few clouds","icon":"02d"}],"base":"stations","main":{"temp":302.15,"pressure":1014,"humidity":51,"temp_min":301.15,"temp_max":303.15},"visibility":16093,"wind":{"speed":2.6,"deg":320},"clouds":{"all":20},"dt":1497905580,"sys":{"type":1,"id":2274,"message":0.0042,"country":"US","sunrise":1497874905,"sunset":1497931383},"id":5746545,"name":"Portland","cod":200}')]),e._v(" "),_("p",[e._v("我们成功的请求了 OpenWeatherMap’s API 并返回了数据。数据里有好多信息，比如 温度、湿度、风速等等")]),e._v(" "),_("p",[e._v("重要提示：你永远不会像这样在你的代码中公开你的API密钥。为了简洁起见，我像这样把它放在公开的地方。在以后的教程中，我将向您展示如何使用环境变量隐藏 API 。现在，只需要知道像这样公开 API 密钥是不标准的。")]),e._v(" "),_("p",[e._v("整理返回数据")]),e._v(" "),_("p",[e._v("这个应用程序还不能用。返回的数据混乱杂乱令人讨厌。让我们把整理下。")]),e._v(" "),_("p",[e._v("我们需要做的第一件事是将返回字符串 json 转换成 JavaScript 对象。")]),e._v(" "),_("p",[e._v("我们用以下代码转换：")]),e._v(" "),_("p",[e._v("let weather = JSON.parse(body)")]),e._v(" "),_("p",[e._v("现在我们有了 JavaScript 对象，我们可以用点或括号符号来访问对象中的数据。下面，我们通过访问天气对象中的数据构造消息字符串。")]),e._v(" "),_("p",[e._v("let message = "),_("code",[e._v("It's ${weather.main.temp} degrees in${weather.name}!")]),e._v(";")]),e._v(" "),_("p",[e._v("console.log(message);")]),e._v(" "),_("p",[e._v("执行程序，输出如下：")]),e._v(" "),_("p",[e._v("node index.js")]),e._v(" "),_("p",[e._v("// It's 300.4 degrees in Portland")]),e._v(" "),_("p",[e._v("稍等。程序没有错，OpenWeatherMap  默认返回 Kelvin 温度。如果需要华氏温度添加参数 units=imperial。")]),e._v(" "),_("p",[e._v("执行代码：")]),e._v(" "),_("p",[e._v("node index.js")]),e._v(" "),_("p",[e._v("// It's 70.1 degrees in Portland")]),e._v(" "),_("p",[e._v("修改后代码如下：")]),e._v(" "),_("p",[e._v("let request = require('request');")]),e._v(" "),_("p",[e._v("let apiKey = '***********************************';")]),e._v(" "),_("p",[e._v("let city = 'portland';")]),e._v(" "),_("p",[e._v("let url = "),_("code",[e._v("http://api.openweathermap.org/data/2.5/weather?q=${city}&units=imperial&appid=${apiKey}")])]),e._v(" "),_("p",[e._v("request(url, function (err, response, body) {")]),e._v(" "),_("p",[e._v("if(err){")]),e._v(" "),_("p",[e._v("​    console.log('error:', error);")]),e._v(" "),_("p",[e._v("} else {")]),e._v(" "),_("p",[e._v("​    let weather = JSON.parse(body)")]),e._v(" "),_("p",[e._v("​    let message = "),_("code",[e._v("It's ${weather.main.temp} degrees in ${weather.name}!")]),e._v(";")]),e._v(" "),_("p",[e._v("​    console.log(message);")]),e._v(" "),_("p",[e._v("}")]),e._v(" "),_("p",[e._v("});")]),e._v(" "),_("p",[e._v("添加交互性")]),e._v(" "),_("p",[e._v("我们的应用程序仍然很无聊。我们只能访问波特兰俄勒冈的天气。让我们添加一些互动。为此，我们将使用yargs(https://www.npmjs.com/package/yargs)。 Yargs是交互式命令行接口工具。或者更简单地说，它允许我们从命令行定义变量。")]),e._v(" "),_("p",[e._v("安装 yargs :")]),e._v(" "),_("p",[e._v("npm install yargs --save")]),e._v(" "),_("p",[e._v("yargs 将控制台输入的变量放在 argv 对象里。我们设置和访问这个对象如下：")]),e._v(" "),_("p",[e._v("const argv = require('yargs').argv;")]),e._v(" "),_("p",[e._v("我们将使用 c 表示城市:")]),e._v(" "),_("p",[e._v("修改 city 变量为 argv.c 。如果没有输入变量，默认为 Portland 。如下：")]),e._v(" "),_("p",[e._v("let city = argv.c || 'portland';")]),e._v(" "),_("p",[e._v("运行程序:")]),e._v(" "),_("p",[e._v("node index.js")]),e._v(" "),_("p",[e._v("我们需要传递一个名为 c 的变量，如下所示")]),e._v(" "),_("p",[e._v("node index.js -c Boston")]),e._v(" "),_("p",[e._v("// It's 85 degrees in Boston")]),e._v(" "),_("p",[e._v("我们使用一个标志表示传递的变量。因为我们将变量设置为字母 c，所以我们用 c 传递变量。c 后面可以跟任何我们想要的城市名称！")]),e._v(" "),_("p",[e._v("node index.js -c Anchorage")]),e._v(" "),_("p",[e._v("// It's 47 degrees in Anchorage")]),e._v(" "),_("p",[e._v("在这一点上，我们的代码入下：")]),e._v(" "),_("p",[e._v("const request = require('request');")]),e._v(" "),_("p",[e._v("const argv = require('yargs').argv;")]),e._v(" "),_("p",[e._v("let apiKey = '*****************************';")]),e._v(" "),_("p",[e._v("let city = argv.c || 'portland';")]),e._v(" "),_("p",[e._v("let url = "),_("code",[e._v("http://api.openweathermap.org/data/2.5/weather?q=${city}&units=imperial&appid=${apiKey}")])]),e._v(" "),_("p",[e._v("request(url, function (err, response, body) {")]),e._v(" "),_("p",[e._v("if(err){")]),e._v(" "),_("p",[e._v("​    console.log('error:', error);")]),e._v(" "),_("p",[e._v("} else {")]),e._v(" "),_("p",[e._v("​    let weather = JSON.parse(body)")]),e._v(" "),_("p",[e._v("​    let message = "),_("code",[e._v("It's ${weather.main.temp} degrees in ${weather.name}!")]),e._v(";")]),e._v(" "),_("p",[e._v("​    console.log(message);")]),e._v(" "),_("p",[e._v("}")]),e._v(" "),_("p",[e._v("});")]),e._v(" "),_("p",[e._v("你做到了！")])])}],!1,null,null,null);r.options.__file="用 Node.js 的 16 行代码创建一个简单的天气 App.md";v.default=r.exports}}]);
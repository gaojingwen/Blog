(window.webpackJsonp=window.webpackJsonp||[]).push([[50],{128:function(e,t,s){"use strict";s.r(t);var a=s(0),i=Object(a.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"content"},[s("h1",{attrs:{id:"vue2-0-项目开发小结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#vue2-0-项目开发小结","aria-hidden":"true"}},[e._v("#")]),e._v(" vue2.0 项目开发小结")]),e._v(" "),s("p",[e._v("离尘不理人 [SegmentFault](javascript:void(0)😉 "),s("em",[e._v("2017-09-11")])]),e._v(" "),s("h4",{attrs:{id:"项目架构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#项目架构","aria-hidden":"true"}},[e._v("#")]),e._v(" 项目架构")]),e._v(" "),s("p",[e._v("项目目录")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("├── build├── config├── dist│   └── static│       ├── css│       ├── fonts│       ├── images│       ├── js│       └── lib├── src│   ├── api│   ├── assets│   │   ├── global│   │   └── images│   │       └── footer│   ├── components│   │   ├── common│   │   ├── news│   │   └── profile│   │       └── charge│   ├── config│   ├── mixin│   ├── router│   ├── service│   ├── store│   └── util└── static    ├── images    └── lib \n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("p",[e._v("项目目录是采用 "),s("code",[e._v("vue-cli")]),e._v(" 自动生成，其它按需自己新建就好了。")]),e._v(" "),s("h4",{attrs:{id:"开发实践"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#开发实践","aria-hidden":"true"}},[e._v("#")]),e._v(" 开发实践")]),e._v(" "),s("p",[s("strong",[e._v("动态修改 document title")])]),e._v(" "),s("p",[e._v("在不同的路由页面，我们需要动态的修改文档标题，可以将每个页面的标题配置在路由元信息 "),s("code",[e._v("meta")]),e._v(" 里面带上，然后在 "),s("code",[e._v("router.beforeEach")]),e._v(" 钩子函数中修改：")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("import Vue from 'vue';import Router from 'vue-router';Vue.use(Router);const router = new Router({  mode: 'history',  routes: [    { path: '/', component: Index, meta: { title: '推荐产品得丰厚奖金' } },    {      path: '/news',      component: News,      meta: { title: '公告列表' },      children: [        { path: '', redirect: 'list' },        { path: 'list', component: NewsList },        { path: 'detail/:newsId', component: NewsDetail, meta: { title: '公告详情' } }      ]    },    {      path: '/guide',      component: GuideProtocol,      meta: {        title: '新手指南'      }    }  ]});router.beforeEach((to, from, next) => {  let documentTitle = '商城会员平台';  // path 是多级的，遍历  to.matched.forEach((path) => {    if (path.meta.title) {      documentTitle += ` - ${path.meta.title}`;    }  });  document.title = documentTitle;  next();});\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("p",[s("strong",[e._v("Event Bus 使用场景")])]),e._v(" "),s("p",[s("img",{attrs:{src:"https://mmbiz.qpic.cn/mmbiz_png/aVp1YC8UV0cHx6kEIFfVV2Jo5lwyicic3pg5bicjq1iaSH7bt0mfYkBicrorUe45UutQ4kxSFMqBUBiclfq1n1kQp7qw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1",alt:"img"}})]),e._v(" "),s("p",[e._v("我们在项目中引入了 "),s("code",[e._v("vuex")]),e._v(" ，通常情况下是不需要使用 "),s("code",[e._v("eventbus")]),e._v(" 的，但是有一种情况下我们需要使用它，那就是在路由钩子函数内部的时，在项目中，我们需要在 "),s("code",[e._v("beforeEnter")]),e._v(" 路由钩子里面对外抛出事件，在这个钩子函数中我们无法去到 "),s("code",[e._v("this")]),e._v(" 对象。")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("beforeEnter: (to, from, next) => {    const userInfo = localStorage.getItem(userFlag);    if (isPrivateMode()) {        EventBus.$emit('get-localdata-error');        next(false);        return;    }})\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("p",[e._v("在 "),s("code",[e._v("App.vue")]),e._v(" 的 "),s("code",[e._v("mouted")]),e._v(" 方法中监听这个事件")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("EventBus.$on('get-localdata-error', () => {    this.$alert('请勿使用无痕模式浏览');});\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("p",[s("strong",[e._v("自定义指令实现埋点数据统计")])]),e._v(" "),s("p",[e._v("在项目中通常需要做数据埋点，这个时候，使用自定义指令将会变非常简单")]),e._v(" "),s("p",[e._v("在项目入口文件 "),s("code",[e._v("main.js")]),e._v(" 中配置我们的自定义指令")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("// 坑位埋点指令Vue.directive('stat', {  bind(el, binding) {    el.addEventListener('click', () => {      const data = binding.value;      let prefix = 'store';      if (OS.isAndroid || OS.isPhone) {        prefix = 'mall';      }      analytics.request({        ty: `${prefix}_${data.type}`,        dc: data.desc || ''      }, 'n');    }, false);  }});\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("p",[e._v("在组件中使用我们的自定义指令")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://mmbiz.qpic.cn/mmbiz_png/aVp1YC8UV0cHx6kEIFfVV2Jo5lwyicic3pzNBdN7sHXnFXU4IT1iaGRVJibLqhTYDvr0ia5PzMxRHhWCYeZWXciaETSA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1",alt:"img"}})]),e._v(" "),s("p",[s("strong",[e._v("使用过滤器实现展示信息格式化")])]),e._v(" "),s("p",[e._v("如下图中奖金数据信息，我们需要将后台返回的奖金格式化为带两位小数点的格式，同时，如果返回的金额是区间类型，需要额外加上 起 字和 ￥ 金额符号")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://mmbiz.qpic.cn/mmbiz_png/aVp1YC8UV0cHx6kEIFfVV2Jo5lwyicic3pzNBdN7sHXnFXU4IT1iaGRVJibLqhTYDvr0ia5PzMxRHhWCYeZWXciaETSA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1",alt:"img"}})]),e._v(" "),s("p",[e._v("在入口文件 "),s("code",[e._v("main.js")]),e._v(" 中配置我们自定义的过滤器")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("Vue.filter('money', (value, config = { unit: '￥', fixed: 2 }) => {  const moneyStr = `${value}`;  if (moneyStr.indexOf('-') > -1) {    const scope = moneyStr.split('-');    return `${config.unit}${parseFloat(scope[0]).toFixed(config.fixed).toString()} 起`;  } else if (value === 0) {    return value;  }  return `${config.unit}${parseFloat(moneyStr).toFixed(config.fixed).toString()}`;});\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("p",[e._v("在组件中使用：")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('<p class="price">{{detail.priceScope | money}}</p><div :class="{singleWrapper: isMobile}">    <p class="rate">比率：{{detail.commissionRateScope}}%</p>    <p class="income">奖金：{{detail.expectedIncome | money}}</p></div>\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("p",[s("strong",[e._v("axios 使用配置")])]),e._v(" "),s("p",[e._v("在项目中，我们使用了 axios 做接口请求")]),e._v(" "),s("p",[e._v("在项目中全局配置 "),s("code",[e._v("/api/common.js")])]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("import axios from 'axios';import qs from 'qs';import store from '../store';// 全局默认配置// 设置 POST 请求头axios.defaults.headers.post['Content-Type'] = 'application/x-www-form-urlencoded';// 配置 CORS 跨域axios.defaults.withCredentials = true;axios.defaults.crossDomain = true;// 请求发起前拦截器axios.interceptors.request.use((config) => {  // 全局 loading 状态，触发 loading 效果  store.dispatch('updateLoadingStatus', {    isLoading: true  });  // POST 请求参数处理成 axios post 方法所需的格式  if (config.method === 'post') {    config.data = qs.stringify(config.data);  }  // 这句不能省，不然后面的请求就无法成功发起，因为读不到配置参数  return config;}, () => {  // 异常处理  store.dispatch('updateLoadingStatus', {    isLoading: false  });});// 响应拦截axios.interceptors.response.use((response) => {  // 关闭 loading 效果  store.dispatch('updateLoadingStatus', {    isLoading: false  });  // 全局登录过滤，如果没有登录，直接跳转到登录 URL  if (response.data.code === 300) {    // 未登录    window.location.href = getLoginUrl();    return false;  }  // 这里返回的 response.data 是被 axios 包装过的一成，所以在这里抽取出来  return response.data;}, (error) => {  store.dispatch('updateLoadingStatus', {    isLoading: false  });  return Promise.reject(error);});// 导出export default axios;\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("p",[e._v("然后我们在接口中使用就方便很多了 "),s("code",[e._v("/api/xxx.js")])]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("import axios from './common';const baseURL = '/api/profile';const USER_BASE_INFO = `${baseURL}/getUserBaseInfo.json`;const UPDATE_USER_INFO = `${baseURL}/saveUserInfo.json`;// 更新用户实名认证信息const updateUserInfo = userinfo => axios.post(UPDATE_USER_INFO, userinfo);// 获取用户基础信息const getUserBaseInfo = () => axios.get(USER_BASE_INFO);\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("p",[s("strong",[e._v("vuex 状态在响应式页面中的妙用")])]),e._v(" "),s("p",[e._v("由于项目是响应式页面，PC 端和移动端在表现成有很多不一致的地方，有时候单单通过 CSS 无法实现交互，这个时候，我们的 "),s("code",[e._v("vuex")]),e._v(" 状态就派上用场了，")]),e._v(" "),s("p",[e._v("我们一开始在 "),s("code",[e._v("App.vue")]),e._v(" 里面监听了页面的 "),s("code",[e._v("resize")]),e._v(" 事件，动态的更新 "),s("code",[e._v("vuex")]),e._v(" 里面 "),s("code",[e._v("isMobile")]),e._v("的状态值")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("window.onresize = throttle(() => { this.updatePlatformStatus({   isMobile: isMobile() });}, 500);\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("p",[e._v("然后，我们在组件层，就能响应式的渲染不同的 "),s("code",[e._v("dom")]),e._v(" 结构了。其中最常见的是 PC 端和移动端加载的图片需要不同的规格的，这个时候我们可以这个做")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('methods: {  loadImgAssets(name, suffix = \'.jpg\') {    return require(`../assets/images/${name}${this.isMobile ? \'-mobile\' : \'\'}${suffix}`);  },}<img class="feed-back" :src="loadImgAssets(\'feed-back\')"<img v-lazy="{src: isMobile ? detail.imgUrlMobile : detail.imgUrlPc, loading: placeholder}">// 动态渲染不同规格的 dislog<el-dialog :visible.sync="dialogVisible" :size="isMobile ? \'full\' : \'tiny\'" top="30%" custom-class="unCertification-dialog"></el-dialog>\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("p",[e._v("下图分别是 PC 端和移动短的表现形式，然后配合 CSS 媒体查询实现各种布局")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://mmbiz.qpic.cn/mmbiz_png/aVp1YC8UV0cHx6kEIFfVV2Jo5lwyicic3pmib4BBBHvxQnfQDXWx2UQJ6W8ib5wibDHPvNwN1R6hGPgPX8wHdbUM3YA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1",alt:"img"}})]),e._v(" "),s("p",[s("img",{attrs:{src:"https://mmbiz.qpic.cn/mmbiz_png/aVp1YC8UV0cHx6kEIFfVV2Jo5lwyicic3p8lbYhfTpia3HI7EKjxwDvfAgvjKmkO3WYQrmUSNLd4y6WnZXATyM2pQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1",alt:"img"}})]),e._v(" "),s("p",[e._v("开发相关配置")]),e._v(" "),s("p",[s("strong",[e._v("反向代理")])]),e._v(" "),s("p",[e._v("在项目目录的 "),s("code",[e._v("config")]),e._v(" 文件下面的 "),s("code",[e._v("index.js")]),e._v(" 配置我们的本地反向代理和端口信息")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("dev: {  env: require('./dev.env'),  port: 80,  autoOpenBrowser: true,  assetsSubDirectory: 'static',  assetsPublicPath: '/',  proxyTable: {    '/api/profile': {      target: '[真实接口地址]:[端口号]', // 例如： http://api.xxx.com      changeOrigin: true,      pathRewrite: {        '^/api/profile': '/profile'      }    }    ...  },\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("p",[e._v("然后我们调用接口的形式就会变成如下映射，当我们调用 "),s("code",[e._v("/api/profile/xxxx")]),e._v(" 的时候，其实是调用了 "),s("code",[e._v("[真实接口地址]/profile/xxxx")])]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("/api/profile/xxxx => [真实接口地址]/profile/xxxx\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("p",[s("strong",[e._v("nginx 配置")])]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("upstream api.xxx.com{ #ip_hash;  server [接口服务器 ip 地址]:[端口];}server {  ...  location ^~ /api/profile {    index index.php index.html index.html;    proxy_redirect off;    proxy_set_header Host $host;    proxy_set_header X-Real-IP $remote_addr;    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;    proxy_pass http://api.xxx.com;    rewrite ^/api/profile/(.*)$ /profile/$1 break;  }  ...}\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("p",[s("strong",[e._v("线上部署")])]),e._v(" "),s("p",[e._v("如果路由使用的是 "),s("code",[e._v("history")]),e._v(" 模式的话，需要在 "),s("code",[e._v("nginx")]),e._v(" 里面配置将所有的请求到转发到 "),s("code",[e._v("index.html")]),e._v(" 去")]),e._v(" "),s("p",[e._v("在 "),s("code",[e._v("nginx.conf")]),e._v(" 或者对应的站点 "),s("code",[e._v("vhost")]),e._v(" 文件下面配置")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("location / {    try_files $uri $uri/ /index.html;}\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("h4",{attrs:{id:"优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#优化","aria-hidden":"true"}},[e._v("#")]),e._v(" 优化")]),e._v(" "),s("p",[s("strong",[e._v("开启静态资源长缓存")])]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("location ~ .*\\.(gif|jpg|jpeg|png|bmp|swf|woff|ttf|eot|svg)$ {    expires 1y;}location ~ .*\\.(js|css)$ {    expires 1y;}\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("p",[s("strong",[e._v("开启静态资源 gzip 压缩")])]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("// 找到 nginx.conf 配置文件vim /data/nginx/conf/nginx.confgzip on;gzip_min_length  1k;gzip_buffers     4 8k;gzip_http_version 1.1;gzip_types text/plain application/javascript application/x-javascript text/javascript text/xml text/css;\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("p",[e._v("开启了 gzip 压缩之后，页面资源请求大小将大大减小，如下图所示，表示已经开启了 "),s("code",[e._v("gzip")]),e._v("压缩")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://mmbiz.qpic.cn/mmbiz_png/aVp1YC8UV0cHx6kEIFfVV2Jo5lwyicic3pxBIBMrFYgJrpicialrfhgEhhDiarpzWibLBKXJdvONyt6ajFgjXLicqL9ibQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1",alt:"img"}})]),e._v(" "),s("h4",{attrs:{id:"q-a"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#q-a","aria-hidden":"true"}},[e._v("#")]),e._v(" Q&A")]),e._v(" "),s("p",[e._v("文章到这就结束了，如果有遗漏或者错误的地方，欢迎私信指出。希望这篇文章能带给大家一丝丝收获。")]),e._v(" "),s("hr")])}],!1,null,null,null);i.options.__file="vue2.0 项目开发小结.md";t.default=i.exports}}]);
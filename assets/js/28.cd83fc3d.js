(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{91:function(s,e,n){"use strict";n.r(e);var t=n(0),a=Object(t.a)({},function(){var s=this,e=s.$createElement,n=s._self._c||e;return n("div",{staticClass:"content"},[s._m(0),s._v(" "),s._m(1),s._v(" "),n("p",[s._v("对象是 JS 中基本类型之一，而且和原型链、数组等知识息息相关。不管是面试中，还是实际开发中我们都会碰见深拷贝对象的问题。")]),s._v(" "),n("p",[s._v("顾名思义，深拷贝就是完完整整的将一个对象从内存中拷贝一份出来。所以无论用什么办法，必然绕不开开辟一块新的内存空间。")]),s._v(" "),n("p",[s._v("通常有下面两种方法实现深拷贝：")]),s._v(" "),s._m(2),s._v(" "),n("p",[s._v("我们会基于一个测试用例对常用的实现方法进行测试并对比优劣：")]),s._v(" "),s._m(3),s._m(4),s._v(" "),n("p",[s._v("这是最常规的方法，思想很简单：就是对对象进行迭代操作，对它的每个值进行递归深拷贝。")]),s._v(" "),n("ul",[n("li",[n("h4",{attrs:{id:"for-in-法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#for-in-法","aria-hidden":"true"}},[s._v("#")]),s._v(" "),n("a",{attrs:{href:"https://link.juejin.im/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FStatements%2Ffor...in",target:"_blank",rel:"noopener noreferrer"}},[s._v("for...in"),n("OutboundLink")],1),s._v(" 法")])])]),s._v(" "),s._m(5),s._m(6),n("p",[s._v('![迭代递归法结果.png](data:image/svg+xml;utf8,<?xml version="1.0"?>'),n("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"509",height:"351"}}),s._v(")")]),s._v(" "),s._m(7),s._m(8),s._v(" "),s._m(9),s._m(10),n("p",[s._v('![代理法结果](data:image/svg+xml;utf8,<?xml version="1.0"?>'),n("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"551",height:"345"}}),s._v(")")]),s._v(" "),s._m(11),n("ul",[n("li",[s._m(12),s._v(" "),n("p",[s._v("著名的 lodash 中的 cloneDeep 方法同样是使用这种方法实现的，只不过它支持的对象种类更多，具体的实现过程读者可以参考"),n("a",{attrs:{href:"https://link.juejin.im/?target=https%3A%2F%2Fgithub.com%2Flodash%2Flodash%2Fblob%2Fmaster%2F.internal%2FbaseClone.js",target:"_blank",rel:"noopener noreferrer"}},[s._v(" lodash 的 baseClone 方法"),n("OutboundLink")],1),s._v("。")]),s._v(" "),n("p",[s._v("我们把测试用例用到的深拷贝函数换成 lodash 的：")]),s._v(" "),s._m(13),n("p",[s._v("结果：")]),s._v(" "),s._m(14),s._v(" "),n("p",[s._v("​")]),s._v(" "),n("p",[s._v("我们发现，arr、obj、date、reg深拷贝成功了，但 func 和 err 内存引用仍然不变。")]),s._v(" "),n("p",[s._v("为什么不变呢？这个问题留给读者自己去探寻，嘿嘿~不过可以提示下，这跟 lodash 中的 cloneableTags 有关。")]),s._v(" "),n("p",[s._v("由于前端中的对象种类太多了，所以 lodash 也给用户准备了自定义深拷贝的方法 "),n("a",{attrs:{href:"https://link.juejin.im/?target=https%3A%2F%2Flodash.com%2Fdocs%2F4.17.5%23cloneDeepWith",target:"_blank",rel:"noopener noreferrer"}},[s._v("cloneDeepWith"),n("OutboundLink")],1),s._v("，比如自定义深拷贝 DOM 对象：")]),s._v(" "),s._m(15)])]),s._v(" "),s._m(16),s._v(" "),n("p",[s._v("这个方法非常有趣，它先把代码序列化成数据，再反序列化回对象：")]),s._v(" "),s._m(17),n("p",[s._v("结果：")]),s._v(" "),s._m(18),s._v(" "),s._m(19),s._v(" "),n("ol",[n("li",[n("p",[s._v("对象成环怎么办？ 我们给 test 加一个 loopObj 键，值指向自身：")]),s._v(" "),s._m(20),n("p",[s._v("这时我们使用第一种方法中的 for..in 实现和 Reflect 实现都会栈溢出：")]),s._v(" "),n("p",[s._v('![环对象深拷贝报错](data:image/svg+xml;utf8,<?xml version="1.0"?>'),n("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"828",height:"159"}}),s._v(")")]),s._v(" "),n("p",[s._v("​")]),s._v(" "),n("p",[s._v("而使用第二种方法也会报错：")]),s._v(" "),n("p",[s._v('![img](data:image/svg+xml;utf8,<?xml version="1.0"?>'),n("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"432",height:"58"}}),s._v(")")]),s._v(" "),n("p",[s._v("​")]),s._v(" "),n("p",[s._v("但 lodash 却可以得到正确结果：")]),s._v(" "),s._m(21),s._v(" "),n("p",[s._v("​")]),s._v(" "),n("p",[s._v("为什么呢？我们去 lodash 源码看看：")]),s._v(" "),s._m(22),s._v(" "),n("p",[s._v("​")]),s._v(" "),n("p",[s._v("因为 lodash 使用的是栈把对象存储起来了，如果有环对象，就会从栈里检测到，从而直接返回结果，悬崖勒马。这种算法思想来源于 HTML5 规范定义的"),n("a",{attrs:{href:"https://link.juejin.im/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FGuide%2FAPI%2FDOM%2FThe_structured_clone_algorithm%23%25E7%259B%25B8%25E5%2585%25B3%25E9%2593%25BE%25E6%258E%25A5",target:"_blank",rel:"noopener noreferrer"}},[s._v("结构化克隆算法"),n("OutboundLink")],1),s._v("，它同时也解释了为什么 lodash 不对 Error 和 Function 类型进行拷贝。")]),s._v(" "),n("p",[s._v("当然，设置一个哈希表存储已拷贝过的对象同样可以达到同样的目的：")]),s._v(" "),s._m(23),n("p",[s._v("这里我们使用 WeakMap 作为哈希表，因为它的键是弱引用的，而我们这个场景里键恰好是对象，需要弱引用。")])]),s._v(" "),n("li",[n("p",[s._v("键不是字符串而是 Symbol")]),s._v(" "),n("p",[s._v("我们修改一下测试用例：")]),s._v(" "),s._m(24),n("p",[s._v("运行 for...in 实现的深拷贝我们会发现：")]),s._v(" "),s._m(25),s._v(" "),n("p",[s._v("​")]),s._v(" "),n("p",[s._v("拷贝失败了，为什么？")]),s._v(" "),n("p",[s._v("因为 "),n("a",{attrs:{href:"https://link.juejin.im/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FGlossary%2FSymbol",target:"_blank",rel:"noopener noreferrer"}},[s._v("Symbol"),n("OutboundLink")],1),s._v(" 是一种特殊的数据类型，它最大的特点便是独一无二，所以它的深拷贝就是浅拷贝。")]),s._v(" "),n("p",[s._v("但如果这时我们使用 Reflect 实现的版本：")]),s._v(" "),s._m(26),s._v(" "),n("p",[s._v("​")]),s._v(" "),n("p",[s._v("成功了，因为 for...in 无法获得 Symbol 类型的键，而 "),n("a",{attrs:{href:"https://link.juejin.im/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FReflect%2FownKeys",target:"_blank",rel:"noopener noreferrer"}},[s._v("Reflect"),n("OutboundLink")],1),s._v(" 是可以获取的。")]),s._v(" "),n("p",[s._v("当然，我们改造一下 for...in 实现也可以：")]),s._v(" "),s._m(27)]),s._v(" "),n("li",[n("p",[s._v("拷贝原型上的属性")]),s._v(" "),n("p",[s._v("众所周知，JS 对象是基于原型链设计的，所以当一个对象的属性查找不到时会沿着它的原型链向上查找，也就是一个非构造函数对象的 "),n("a",{attrs:{href:"https://link.juejin.im/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FObject%2Fproto",target:"_blank",rel:"noopener noreferrer"}},[n("strong",[s._v("proto")]),n("OutboundLink")],1),s._v(" 属性。")]),s._v(" "),n("p",[s._v("我们创建一个 childTest 变量，让 result 为它的深拷贝结果，其他不变：")]),s._v(" "),s._m(28),n("p",[s._v("这时，我们最初提供的四种实现只有 for...in 的实现能正确拷贝，为什么呢？原因还是在"),n("a",{attrs:{href:"https://link.juejin.im/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FGuide%2FAPI%2FDOM%2FThe_structured_clone_algorithm%23%25E7%259B%25B8%25E5%2585%25B3%25E9%2593%25BE%25E6%258E%25A5",target:"_blank",rel:"noopener noreferrer"}},[s._v("结构化克隆算法"),n("OutboundLink")],1),s._v("里：原形链上的属性也不会被追踪以及复制。")]),s._v(" "),n("p",[s._v("落在具体实现上就是：for...in 会追踪原型链上的属性，而其它三种方法(Object.keys、Reflect.ownKeys 和 JSON 方法)都不会追踪原型链上的属性：")]),s._v(" "),s._m(29),s._v(" "),n("p",[s._v("​")])]),s._v(" "),s._m(30)]),s._v(" "),s._m(31),s._v(" "),s._m(32),s._v(" "),s._m(33),n("ol",[n("li",[n("p",[s._v("有特殊需求的深拷贝，建议使用 lodash 的 copyDeep 或 copyDeepWith 方法。")]),s._v(" "),n("p",[s._v("最后感谢一下"),n("a",{attrs:{href:"https://link.juejin.im/?target=https%3A%2F%2Fwww.zhihu.com%2Fquestion%2F47746441",target:"_blank",rel:"noopener noreferrer"}},[s._v("知乎上关于这个问题"),n("OutboundLink")],1),s._v("的启发，无论做什么，尽量不要把简单的事情复杂化，深拷贝能不用就不用，它面对的问题往往可以用更优雅的方式解决，比如使用一个函数来得到对象，当然面试的时候装个逼是可以的。")])])])])},[function(){var s=this.$createElement,e=this._self._c||s;return e("h1",{attrs:{id:"深入深入再深入-js-深拷贝对象"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#深入深入再深入-js-深拷贝对象","aria-hidden":"true"}},[this._v("#")]),this._v(" 深入深入再深入 js 深拷贝对象")])},function(){var s=this.$createElement,e=this._self._c||s;return e("h2",{attrs:{id:"前言"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#前言","aria-hidden":"true"}},[this._v("#")]),this._v(" 前言")])},function(){var s=this.$createElement,e=this._self._c||s;return e("ol",[e("li",[this._v("迭代递归法")]),this._v(" "),e("li",[this._v("序列化反序列化法")])])},function(){var s=this,e=s.$createElement,n=s._self._c||e;return n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("let test = {\n    num: 0,\n    str: '',\n    boolean: true,\n    unf: undefined,\n    nul: null,\n    obj: {\n        name: '我是一个对象',\n        id: 1\n    },\n    arr: [0, 1, 2],\n    func: function() {\n        console.log('我是一个函数')\n    },\n    date: new Date(0),\n    reg: new RegExp('/我是一个正则/ig'),\n    err: new Error('我是一个错误')\n}\n\nlet result = deepClone(test)\n\nconsole.log(result)\nfor (let key in result) {\n    if (isObject(result[key]))\n        console.log(`${key}相同吗？ `, result[key] === test[key])\n}\n\n// 判断是否为对象\nfunction isObject(o) {\n    return (typeof o === 'object' || typeof o === 'function') && o !== null\n}\n复制代码\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br")])])},function(){var s=this.$createElement,e=this._self._c||s;return e("h3",{attrs:{id:"_1-迭代递归法"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-迭代递归法","aria-hidden":"true"}},[this._v("#")]),this._v(" 1. 迭代递归法")])},function(){var s=this,e=s.$createElement,n=s._self._c||e;return n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("// 迭代递归法：深拷贝对象与数组\nfunction deepClone(obj) {\n    if (!isObject(obj)) {\n        throw new Error('obj 不是一个对象！')\n    }\n\n    let isArray = Array.isArray(obj)\n    let cloneObj = isArray ? [] : {}\n    for (let key in obj) {\n        cloneObj[key] = isObject(obj[key]) ? deepClone(obj[key]) : obj[key]\n    }\n\n    return cloneObj\n}\n复制代码\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])])},function(){var s=this.$createElement,e=this._self._c||s;return e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("结果：\n复制代码\n")])]),this._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[this._v("1")]),e("br"),e("span",{staticClass:"line-number"},[this._v("2")]),e("br")])])},function(){var s=this.$createElement,e=this._self._c||s;return e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("我们发现，arr 和 obj 都深拷贝成功了，它们的内存引用已经不同了，但 func、date、reg 和 err 并没有复制成功，因为它们有特殊的构造函数。\n复制代码\n")])]),this._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[this._v("1")]),e("br"),e("span",{staticClass:"line-number"},[this._v("2")]),e("br")])])},function(){var s=this.$createElement,e=this._self._c||s;return e("ul",[e("li",[e("h4",{attrs:{id:"reflect-法"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#reflect-法","aria-hidden":"true"}},[this._v("#")]),this._v(" Reflect 法")])])])},function(){var s=this,e=s.$createElement,n=s._self._c||e;return n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("// 代理法\nfunction deepClone(obj) {\n    if (!isObject(obj)) {\n        throw new Error('obj 不是一个对象！')\n    }\n\n    let isArray = Array.isArray(obj)\n    let cloneObj = isArray ? [...obj] : { ...obj }\n    Reflect.ownKeys(cloneObj).forEach(key => {\n        cloneObj[key] = isObject(obj[key]) ? deepClone(obj[key]) : obj[key]\n    })\n\n    return cloneObj\n}\n复制代码\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])])},function(){var s=this.$createElement,e=this._self._c||s;return e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("结果：\n复制代码\n")])]),this._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[this._v("1")]),e("br"),e("span",{staticClass:"line-number"},[this._v("2")]),e("br")])])},function(){var s=this.$createElement,e=this._self._c||s;return e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("我们发现，结果和使用 for...in 一样。那么它有什么优点呢？读者可以先猜一猜，答案我们会在下文揭晓。\n复制代码\n")])]),this._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[this._v("1")]),e("br"),e("span",{staticClass:"line-number"},[this._v("2")]),e("br")])])},function(){var s=this.$createElement,e=this._self._c||s;return e("h4",{attrs:{id:"lodash-中的深拷贝"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#lodash-中的深拷贝","aria-hidden":"true"}},[this._v("#")]),this._v(" lodash 中的深拷贝")])},function(){var s=this.$createElement,e=this._self._c||s;return e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("let result = _.cloneDeep(test)\n复制代码\n")])]),this._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[this._v("1")]),e("br"),e("span",{staticClass:"line-number"},[this._v("2")]),e("br")])])},function(){var s=this.$createElement,e=this._self._c||s;return e("p",[e("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2018/4/18/162d6bbd7414c09c?imageView2/0/w/1280/h/960/format/webp/ignore-error/1",alt:"lodash深拷贝结果.png"}})])},function(){var s=this,e=s.$createElement,n=s._self._c||e;return n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("function customizer(value) {\n  if (_.isElement(value)) {\n    return value.cloneNode(true);\n  }\n}\n\nvar el = _.cloneDeepWith(document.body, customizer);\n \nconsole.log(el === document.body);\n// => false\nconsole.log(el.nodeName);\n// => 'BODY'\nconsole.log(el.childNodes.length);\n// => 20\n复制代码\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])])},function(){var s=this.$createElement,e=this._self._c||s;return e("h3",{attrs:{id:"_2-序列化反序列化法"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-序列化反序列化法","aria-hidden":"true"}},[this._v("#")]),this._v(" 2.序列化反序列化法")])},function(){var s=this.$createElement,e=this._self._c||s;return e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("// 序列化反序列化法\nfunction deepClone(obj) {\n    return JSON.parse(JSON.stringify(obj))\n}\n复制代码\n")])]),this._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[this._v("1")]),e("br"),e("span",{staticClass:"line-number"},[this._v("2")]),e("br"),e("span",{staticClass:"line-number"},[this._v("3")]),e("br"),e("span",{staticClass:"line-number"},[this._v("4")]),e("br"),e("span",{staticClass:"line-number"},[this._v("5")]),e("br")])])},function(){var s=this.$createElement,e=this._self._c||s;return e("p",[e("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2018/4/18/162d6bbd73c055b2?imageView2/0/w/1280/h/960/format/webp/ignore-error/1",alt:"序列化反序列化法结果.png"}})])},function(){var s=this.$createElement,e=this._self._c||s;return e("h3",{attrs:{id:"深入深入再深入"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#深入深入再深入","aria-hidden":"true"}},[this._v("#")]),this._v(" 深入深入再深入")])},function(){var s=this.$createElement,e=this._self._c||s;return e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("test.loopObj = test\n复制代码\n")])]),this._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[this._v("1")]),e("br"),e("span",{staticClass:"line-number"},[this._v("2")]),e("br")])])},function(){var s=this.$createElement,e=this._self._c||s;return e("p",[e("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2018/4/18/162d6bbd945ea83b?imageView2/0/w/1280/h/960/format/webp/ignore-error/1",alt:"lodash 深拷贝环对象.png"}})])},function(){var s=this.$createElement,e=this._self._c||s;return e("p",[e("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2018/4/18/162d6bbd8d654360?imageView2/0/w/1280/h/960/format/webp/ignore-error/1",alt:"lodash 应对环对象办法.png"}})])},function(){var s=this,e=s.$createElement,n=s._self._c||e;return n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("function deepClone(obj, hash = new WeakMap()) {\n    if (!isObject(obj)) {\n        return obj\n    }\n    // 查表\n    if (hash.has(obj)) return hash.get(obj)\n\n    let isArray = Array.isArray(obj)\n    let cloneObj = isArray ? [] : {}\n    // 哈希表设值\n    hash.set(obj, cloneObj)\n\n    let result = Object.keys(obj).map(key => {\n        return {\n            [key]: deepClone(obj[key], hash)\n        }\n    })\n    return Object.assign(cloneObj, ...result)\n}\n复制代码\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br")])])},function(){var s=this,e=s.$createElement,n=s._self._c||e;return n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("var test = {}\nlet sym = Symbol('我是一个Symbol')\ntest[sym] = 'symbol'\n\nlet result = deepClone(test)\nconsole.log(result)\nconsole.log(result[sym] === test[sym])\n复制代码\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])])},function(){var s=this.$createElement,e=this._self._c||s;return e("p",[e("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2018/4/18/162d6bbd94bd9e48?imageView2/0/w/1280/h/960/format/webp/ignore-error/1",alt:"img"}})])},function(){var s=this.$createElement,e=this._self._c||s;return e("p",[e("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2018/4/18/162d6bbd8beff39b?imageView2/0/w/1280/h/960/format/webp/ignore-error/1",alt:"img"}})])},function(){var s=this,e=s.$createElement,n=s._self._c||e;return n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("function deepClone(obj) {\n    if (!isObject(obj)) {\n        throw new Error('obj 不是一个对象！')\n    }\n\n    let isArray = Array.isArray(obj)\n    let cloneObj = isArray ? [] : {}\n    let symKeys = Object.getOwnPropertySymbols(obj)\n    // console.log(symKey)\n    if (symKeys.length > 0) {\n        symKeys.forEach(symKey => {\n            cloneObj[symKey] =  isObject(obj[symKey]) ? deepClone(obj[symKey]) : obj[symKey]\n        })\n    }\n    for (let key in obj) {\n        cloneObj[key] = isObject(obj[key]) ? deepClone(obj[key]) : obj[key]\n    }\n\n    return cloneObj\n}\n复制代码\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br")])])},function(){var s=this.$createElement,e=this._self._c||s;return e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("let childTest = Object.create(test)\nlet result = deepClone(childTest)\n复制代码\n")])]),this._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[this._v("1")]),e("br"),e("span",{staticClass:"line-number"},[this._v("2")]),e("br"),e("span",{staticClass:"line-number"},[this._v("3")]),e("br")])])},function(){var s=this.$createElement,e=this._self._c||s;return e("p",[e("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2018/4/18/162d6bbd8adfc64f?imageView2/0/w/1280/h/960/format/webp/ignore-error/1",alt:"img"}})])},function(){var s=this,e=s.$createElement,n=s._self._c||e;return n("li",[n("p",[s._v("需要拷贝不可枚举的属性")]),s._v(" "),n("p",[s._v("第四种情况，就是我们需要拷贝类似属性描述符，setters 以及 getters 这样不可枚举的属性，一般来说，这就需要一个额外的不可枚举的属性集合来存储它们。类似在第二种情况使用 for...in 拷贝 Symbol 类型键时： 我们给 test 变量里的 obj 和 arr 属性定义一下属性描述符：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("Object.defineProperties(test, {\n    'obj': {\n        writable: false,\n        enumerable: false,\n        configurable: false\n    },\n    'arr': {\n        get() {\n            console.log('调用了get')\n            return [1,2,3]\n        },\n        set(val) {\n            console.log('调用了set')\n        }\n    }\n})\n复制代码\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])]),n("p",[s._v("然后实现我们的拷贝不可枚举属性的版本：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("function deepClone(obj, hash = new WeakMap()) {\n    if (!isObject(obj)) {\n        return obj\n    }\n    // 查表，防止循环拷贝\n    if (hash.has(obj)) return hash.get(obj)\n\n    let isArray = Array.isArray(obj)\n    // 初始化拷贝对象\n    let cloneObj = isArray ? [] : {}\n    // 哈希表设值\n    hash.set(obj, cloneObj)\n    // 获取源对象所有属性描述符\n    let allDesc = Object.getOwnPropertyDescriptors(obj)\n    // 获取源对象所有的 Symbol 类型键\n    let symKeys = Object.getOwnPropertySymbols(obj)\n    // 拷贝 Symbol 类型键对应的属性\n    if (symKeys.length > 0) {\n        symKeys.forEach(symKey => {\n            cloneObj[symKey] = isObject(obj[symKey]) ? deepClone(obj[symKey], hash) : obj[symKey]\n        })\n    }\n\n    // 拷贝不可枚举属性,因为 allDesc 的 value 是浅拷贝，所以要放在前面\n    cloneObj = Object.create(\n        Object.getPrototypeOf(cloneObj),\n        allDesc\n    )\n    // 拷贝可枚举属性（包括原型链上的）\n    for (let key in obj) {\n        cloneObj[key] = isObject(obj[key]) ? deepClone(obj[key], hash) : obj[key];\n    }\n\n    return cloneObj\n}\n复制代码\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br")])]),n("p",[s._v("结果：")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2018/4/18/162d6bbd96040dff?imageView2/0/w/1280/h/960/format/webp/ignore-error/1",alt:"img"}})]),s._v(" "),n("p",[s._v("​")])])},function(){var s=this.$createElement,e=this._self._c||s;return e("h3",{attrs:{id:"结语"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#结语","aria-hidden":"true"}},[this._v("#")]),this._v(" 结语")])},function(){var s=this.$createElement,e=this._self._c||s;return e("ol",[e("li",[this._v("日常深拷贝，建议序列化反序列化方法。")]),this._v(" "),e("li",[this._v("面试时遇见面试官搞事情，写一个能拷贝自身可枚举、自身不可枚举、自身 Symbol 类型键、原型上可枚举、原型上不可枚举、原型上的 Symol 类型键，循环引用也可以拷的深拷贝函数：")])])},function(){var s=this,e=s.$createElement,n=s._self._c||e;return n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("// 将之前写的 deepClone 函数封装一下\nfunction cloneDeep(obj) {\n    let family = {}\n    let parent = Object.getPrototypeOf(obj)\n\n    while (parent != null) {\n        family = completeAssign(deepClone(family), parent)\n        parent = Object.getPrototypeOf(parent)\n    }\n\n    // 下面这个函数会拷贝所有自有属性的属性描述符,来自于 MDN\n    // https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/assign\n    function completeAssign(target, ...sources) {\n        sources.forEach(source => {\n            let descriptors = Object.keys(source).reduce((descriptors, key) => {\n                descriptors[key] = Object.getOwnPropertyDescriptor(source, key)\n                return descriptors\n            }, {})\n\n            // Object.assign 默认也会拷贝可枚举的Symbols\n            Object.getOwnPropertySymbols(source).forEach(sym => {\n                let descriptor = Object.getOwnPropertyDescriptor(source, sym)\n                if (descriptor.enumerable) {\n                    descriptors[sym] = descriptor\n                }\n            })\n            Object.defineProperties(target, descriptors)\n        })\n        return target\n    }\n\n    return completeAssign(deepClone(obj), family)\n}\n\n复制代码\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br")])])}],!1,null,null,null);a.options.__file="深入深入再深入 js 深拷贝对象.md";e.default=a.exports}}]);
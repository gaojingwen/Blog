<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ES2018 æ–°ç‰¹å¾ä¹‹ï¼šå¼‚æ­¥è¿­ä»£å™¨ for-await-of | å°ä¸‰èƒ–æŠ€æœ¯æ ˆ</title>
    <meta name="description" content="ä½›ç³»å‰ç«¯å¤§ç¥">
    <meta charset="UTF-8">
  <link rel="icon" href="/Blog/favicon.ico">
    
    <link rel="preload" href="/Blog/assets/css/0.styles.9ba1bd5b.css" as="style"><link rel="preload" href="/Blog/assets/js/app.b624378b.js" as="script"><link rel="preload" href="/Blog/assets/js/13.1af90041.js" as="script"><link rel="prefetch" href="/Blog/assets/js/25.812a025f.js"><link rel="prefetch" href="/Blog/assets/js/2.6f79cb1b.js"><link rel="prefetch" href="/Blog/assets/js/3.d16a0c2c.js"><link rel="prefetch" href="/Blog/assets/js/4.981975ce.js"><link rel="prefetch" href="/Blog/assets/js/5.22251c73.js"><link rel="prefetch" href="/Blog/assets/js/6.628e770d.js"><link rel="prefetch" href="/Blog/assets/js/7.07e2b6b4.js"><link rel="prefetch" href="/Blog/assets/js/8.2bccae8e.js"><link rel="prefetch" href="/Blog/assets/js/9.5fab895e.js"><link rel="prefetch" href="/Blog/assets/js/10.322ce4df.js"><link rel="prefetch" href="/Blog/assets/js/11.006e4719.js"><link rel="prefetch" href="/Blog/assets/js/12.3333e057.js"><link rel="prefetch" href="/Blog/assets/js/14.182c46a3.js"><link rel="prefetch" href="/Blog/assets/js/15.1cbbb4a1.js"><link rel="prefetch" href="/Blog/assets/js/16.49b9f0b6.js"><link rel="prefetch" href="/Blog/assets/js/17.29b175e7.js"><link rel="prefetch" href="/Blog/assets/js/18.297427c5.js"><link rel="prefetch" href="/Blog/assets/js/19.2663f562.js"><link rel="prefetch" href="/Blog/assets/js/20.b7420290.js"><link rel="prefetch" href="/Blog/assets/js/21.d39c8908.js"><link rel="prefetch" href="/Blog/assets/js/22.f1126d66.js"><link rel="prefetch" href="/Blog/assets/js/23.4a7a29be.js"><link rel="prefetch" href="/Blog/assets/js/24.e6bca216.js"><link rel="prefetch" href="/Blog/assets/js/26.9960f054.js"><link rel="prefetch" href="/Blog/assets/js/27.fc3fad79.js"><link rel="prefetch" href="/Blog/assets/js/28.cd83fc3d.js"><link rel="prefetch" href="/Blog/assets/js/29.443e4941.js"><link rel="prefetch" href="/Blog/assets/js/30.6a8a17b9.js"><link rel="prefetch" href="/Blog/assets/js/31.8fc47db9.js"><link rel="prefetch" href="/Blog/assets/js/32.b715a23d.js"><link rel="prefetch" href="/Blog/assets/js/33.518efbd0.js"><link rel="prefetch" href="/Blog/assets/js/34.76e7b1b1.js"><link rel="prefetch" href="/Blog/assets/js/35.f8a6b00b.js"><link rel="prefetch" href="/Blog/assets/js/36.8c12af51.js"><link rel="prefetch" href="/Blog/assets/js/37.cda5ca1d.js"><link rel="prefetch" href="/Blog/assets/js/38.60935ef0.js"><link rel="prefetch" href="/Blog/assets/js/39.26c637dd.js"><link rel="prefetch" href="/Blog/assets/js/40.44a0bfa7.js"><link rel="prefetch" href="/Blog/assets/js/41.259d1527.js"><link rel="prefetch" href="/Blog/assets/js/42.ab80d836.js"><link rel="prefetch" href="/Blog/assets/js/43.0af190a7.js"><link rel="prefetch" href="/Blog/assets/js/44.093f7743.js"><link rel="prefetch" href="/Blog/assets/js/45.8c17580f.js"><link rel="prefetch" href="/Blog/assets/js/46.fd30eace.js"><link rel="prefetch" href="/Blog/assets/js/47.214dd0f8.js"><link rel="prefetch" href="/Blog/assets/js/48.d43dc2ae.js"><link rel="prefetch" href="/Blog/assets/js/49.6136b23c.js"><link rel="prefetch" href="/Blog/assets/js/50.fd4e81e2.js"><link rel="prefetch" href="/Blog/assets/js/51.9fa346c5.js"><link rel="prefetch" href="/Blog/assets/js/52.6e5d9385.js"><link rel="prefetch" href="/Blog/assets/js/53.19db09c4.js">
    <link rel="stylesheet" href="/Blog/assets/css/0.styles.9ba1bd5b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Blog/" class="home-link router-link-active"><!----> <span class="site-name">å°ä¸‰èƒ–æŠ€æœ¯æ ˆ</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Blog/recondRESUME/" class="nav-link">Resume</a></div><div class="nav-item"><a href="/Blog/recondCSS/" class="nav-link">Css</a></div><div class="nav-item"><a href="/Blog/recondJAVASCRIPT/" class="nav-link">Javascript</a></div><div class="nav-item"><a href="/Blog/recondVUE/" class="nav-link">Vue</a></div><div class="nav-item"><a href="/Blog/recondNODE/" class="nav-link">Node</a></div><div class="nav-item"><a href="/Blog/recondES6/" class="nav-link router-link-active">Es6</a></div><div class="nav-item"><a href="/Blog/recondPROJECT/" class="nav-link">projectify</a></div><div class="nav-item"><a href="/Blog/recondSUMMARY/" class="nav-link">summary</a></div><div class="nav-item"><a href="/Blog/recondFEATURE/" class="nav-link">feature</a></div><div class="nav-item"><a href="/Blog/recondGIT/" class="nav-link">git</a></div><div class="nav-item"><a href="/Blog/recondOTHER/" class="nav-link">other</a></div><div class="nav-item"><a href="https://github.com/gaojingwen" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHubåœ°å€
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Blog/recondRESUME/" class="nav-link">Resume</a></div><div class="nav-item"><a href="/Blog/recondCSS/" class="nav-link">Css</a></div><div class="nav-item"><a href="/Blog/recondJAVASCRIPT/" class="nav-link">Javascript</a></div><div class="nav-item"><a href="/Blog/recondVUE/" class="nav-link">Vue</a></div><div class="nav-item"><a href="/Blog/recondNODE/" class="nav-link">Node</a></div><div class="nav-item"><a href="/Blog/recondES6/" class="nav-link router-link-active">Es6</a></div><div class="nav-item"><a href="/Blog/recondPROJECT/" class="nav-link">projectify</a></div><div class="nav-item"><a href="/Blog/recondSUMMARY/" class="nav-link">summary</a></div><div class="nav-item"><a href="/Blog/recondFEATURE/" class="nav-link">feature</a></div><div class="nav-item"><a href="/Blog/recondGIT/" class="nav-link">git</a></div><div class="nav-item"><a href="/Blog/recondOTHER/" class="nav-link">other</a></div><div class="nav-item"><a href="https://github.com/gaojingwen" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHubåœ°å€
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>Es6</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/Blog/recondES6/" class="sidebar-link">å¤§ç¬¨è›‹</a></li><li><a href="/Blog/recondES6/ES2018 æ–°ç‰¹å¾ä¹‹ï¼šå¼‚æ­¥è¿­ä»£å™¨ for-await-of.html" class="active sidebar-link">ES2018 æ–°ç‰¹å¾ä¹‹ï¼šå¼‚æ­¥è¿­ä»£å™¨ for-await-of</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Blog/recondES6/ES2018 æ–°ç‰¹å¾ä¹‹ï¼šå¼‚æ­¥è¿­ä»£å™¨ for-await-of.html#_1-æ¦‚è¿°" class="sidebar-link">1. æ¦‚è¿°</a></li><li class="sidebar-sub-header"><a href="/Blog/recondES6/ES2018 æ–°ç‰¹å¾ä¹‹ï¼šå¼‚æ­¥è¿­ä»£å™¨ for-await-of.html#_2-å¯è¿­ä»£å¯¹è±¡" class="sidebar-link">2. å¯è¿­ä»£å¯¹è±¡</a></li><li class="sidebar-sub-header"><a href="/Blog/recondES6/ES2018 æ–°ç‰¹å¾ä¹‹ï¼šå¼‚æ­¥è¿­ä»£å™¨ for-await-of.html#_3-åŒæ­¥è¿­ä»£" class="sidebar-link">3. åŒæ­¥è¿­ä»£</a></li><li class="sidebar-sub-header"><a href="/Blog/recondES6/ES2018 æ–°ç‰¹å¾ä¹‹ï¼šå¼‚æ­¥è¿­ä»£å™¨ for-await-of.html#_4-å¼‚æ­¥è¿­ä»£å™¨" class="sidebar-link">4. å¼‚æ­¥è¿­ä»£å™¨</a></li><li class="sidebar-sub-header"><a href="/Blog/recondES6/ES2018 æ–°ç‰¹å¾ä¹‹ï¼šå¼‚æ­¥è¿­ä»£å™¨ for-await-of.html#_5-åŒæ­¥è¿­ä»£å™¨-vs-å¼‚æ­¥è¿­ä»£å™¨" class="sidebar-link">5. åŒæ­¥è¿­ä»£å™¨ vs å¼‚æ­¥è¿­ä»£å™¨</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Blog/recondES6/ES2018 æ–°ç‰¹å¾ä¹‹ï¼šå¼‚æ­¥è¿­ä»£å™¨ for-await-of.html#_5-1-iterators" class="sidebar-link">5.1 Iterators</a></li><li class="sidebar-sub-header"><a href="/Blog/recondES6/ES2018 æ–°ç‰¹å¾ä¹‹ï¼šå¼‚æ­¥è¿­ä»£å™¨ for-await-of.html#_5-2-async-iterators" class="sidebar-link">5.2 Async Iterators</a></li></ul></li><li class="sidebar-sub-header"><a href="/Blog/recondES6/ES2018 æ–°ç‰¹å¾ä¹‹ï¼šå¼‚æ­¥è¿­ä»£å™¨ for-await-of.html#_6-å¼‚æ­¥ç”Ÿæˆå™¨å‡½æ•°" class="sidebar-link">6. å¼‚æ­¥ç”Ÿæˆå™¨å‡½æ•°</a></li><li class="sidebar-sub-header"><a href="/Blog/recondES6/ES2018 æ–°ç‰¹å¾ä¹‹ï¼šå¼‚æ­¥è¿­ä»£å™¨ for-await-of.html#_7-å®ç°" class="sidebar-link">7. å®ç°</a></li><li class="sidebar-sub-header"><a href="/Blog/recondES6/ES2018 æ–°ç‰¹å¾ä¹‹ï¼šå¼‚æ­¥è¿­ä»£å™¨ for-await-of.html#polyfills" class="sidebar-link">Polyfills</a></li></ul></li><li><a href="/Blog/recondES6/ä»promiseåˆ°async function.html" class="sidebar-link">ä»promiseåˆ°async function</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="es2018-æ–°ç‰¹å¾ä¹‹ï¼šå¼‚æ­¥è¿­ä»£å™¨-for-await-of"><a href="#es2018-æ–°ç‰¹å¾ä¹‹ï¼šå¼‚æ­¥è¿­ä»£å™¨-for-await-of" aria-hidden="true" class="header-anchor">#</a> ES2018 æ–°ç‰¹å¾ä¹‹ï¼šå¼‚æ­¥è¿­ä»£å™¨ for-await-of</h1> <p>åŸåˆ›ï¼š justjavac [justjavac](javascript:void(0)ğŸ˜‰ <em>2æœˆ26æ—¥</em></p> <h2 id="_1-æ¦‚è¿°"><a href="#_1-æ¦‚è¿°" aria-hidden="true" class="header-anchor">#</a> 1. æ¦‚è¿°</h2> <p>åœ¨ ECMAScript 2015(ES6) ä¸­ JavaScript å¼•å…¥äº†è¿­ä»£å™¨æ¥å£ï¼ˆiteratorï¼‰ç”¨æ¥éå†æ•°æ®ã€‚è¿­ä»£å™¨å¯¹è±¡çŸ¥é“å¦‚ä½•æ¯æ¬¡è®¿é—®é›†åˆä¸­çš„ä¸€é¡¹ï¼Œ å¹¶è·Ÿè¸ªè¯¥åºåˆ—ä¸­çš„å½“å‰ä½ç½®ã€‚åœ¨ JavaScript ä¸­è¿­ä»£å™¨æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒæä¾›äº†ä¸€ä¸ª <code>next()</code> æ–¹æ³•ï¼Œç”¨æ¥è¿”å›åºåˆ—ä¸­çš„ä¸‹ä¸€é¡¹ã€‚è¿™ä¸ªæ–¹æ³•è¿”å›åŒ…å«ä¸¤ä¸ªå±æ€§ï¼š <code>done</code> å’Œ <code>value</code>ã€‚</p> <p>è¿­ä»£å™¨å¯¹è±¡ä¸€æ—¦è¢«åˆ›å»ºï¼Œå°±å¯ä»¥åå¤è°ƒç”¨ <code>next()</code>ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>function makeIterator(array) {  let nextIndex = 0;  // åˆå§‹ç´¢å¼•  // è¿”å›ä¸€ä¸ªè¿­ä»£å™¨å¯¹è±¡ï¼Œå¯¹è±¡çš„å±æ€§æ˜¯ä¸€ä¸ª next æ–¹æ³•  return {    next: function() {      if (nextIndex &lt; array.length) {        // å½“æ²¡æœ‰åˆ°è¾¾æœ«å°¾æ—¶ï¼Œè¿”å›å½“å‰å€¼ï¼Œå¹¶æŠŠç´¢å¼•åŠ 1        return { value: array[nextIndex++], done: false };      }      // åˆ°è¾¾æœ«å°¾ï¼Œdone å±æ€§ä¸º true      return {done: true};    }  };}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>ä¸€æ—¦åˆå§‹åŒ–ï¼Œ <code>next()</code> æ–¹æ³•å¯ä»¥ç”¨æ¥ä¾æ¬¡è®¿é—®å¯¹è±¡ä¸­çš„é”®å€¼ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>const it = makeIterator(['j', 'u', 's', 't']);it.next().value;  // jit.next().value;  // uit.next().value;  // sit.next().value;  // tit.next().value;  // undefinedit.next().done;   // trueit.next().value;  // undefined
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="_2-å¯è¿­ä»£å¯¹è±¡"><a href="#_2-å¯è¿­ä»£å¯¹è±¡" aria-hidden="true" class="header-anchor">#</a> 2. å¯è¿­ä»£å¯¹è±¡</h2> <p>ä¸€ä¸ªå®šä¹‰äº†<strong>è¿­ä»£è¡Œä¸º</strong>çš„å¯¹è±¡ï¼Œæ¯”å¦‚åœ¨ <code>for...of</code> ä¸­å¾ªç¯äº†å“ªäº›å€¼ã€‚ä¸ºäº†å®ç°å¯è¿­ä»£ï¼Œä¸€ä¸ªå¯¹è±¡å¿…é¡»å®ç° <code>@@iterator</code> æ–¹æ³•ï¼Œè¿™æ„å‘³ç€è¿™ä¸ªå¯¹è±¡ï¼ˆæˆ–å…¶åŸå‹é“¾ä¸­çš„ä¸€ä¸ªå¯¹è±¡ï¼‰å¿…é¡»å…·æœ‰å¸¦ <code>Symbol.iterator</code> é”®çš„å±æ€§ï¼š</p> <p><code>String</code>ï¼Œ <code>Array</code>ï¼Œ <code>TypedArray</code>ï¼Œ <code>Map</code> å’Œ <code>Set</code> éƒ½å†…ç½®å¯è¿­ä»£å¯¹è±¡ï¼Œå› ä¸ºå®ƒä»¬çš„åŸå‹å¯¹è±¡éƒ½æœ‰ä¸€ä¸ª <code>Symbol.iterator</code> æ–¹æ³•ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>const justjavac = {  [Symbol.iterator]: () =&gt; {    const items = [`j`, `u`, `s`, `t`, `j`, `a`, `v`, `a`, `c`];    return {      next: () =&gt; ({        done: items.length === 0,        value: items.shift()      })    }  }}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>å½“æˆ‘ä»¬å®šä¹‰äº†å¯è¿­ä»£å¯¹è±¡åï¼Œå°±å¯ä»¥åœ¨ <code>Array.from</code>ã€ <code>for...of</code> ä¸­ä½¿ç”¨è¿™ä¸ªå¯¹è±¡ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[...justjavac];// [&quot;j&quot;, &quot;u&quot;, &quot;s&quot;, &quot;t&quot;, &quot;j&quot;, &quot;a&quot;, &quot;v&quot;, &quot;a&quot;, &quot;c&quot;]Array.from(justjavac)// [&quot;j&quot;, &quot;u&quot;, &quot;s&quot;, &quot;t&quot;, &quot;j&quot;, &quot;a&quot;, &quot;v&quot;, &quot;a&quot;, &quot;c&quot;]new Set(justjavac);// {&quot;j&quot;, &quot;u&quot;, &quot;s&quot;, &quot;t&quot;, &quot;a&quot;, &quot;v&quot;, &quot;c&quot;}for (const item of justjavac) {  console.log(item)}// j // u // s // t // j // a // v // a // c
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="_3-åŒæ­¥è¿­ä»£"><a href="#_3-åŒæ­¥è¿­ä»£" aria-hidden="true" class="header-anchor">#</a> 3. åŒæ­¥è¿­ä»£</h2> <p>ç”±äºåœ¨è¿­ä»£å™¨æ–¹æ³•è¿”å›æ—¶ï¼Œåºåˆ—ä¸­çš„ä¸‹ä¸€ä¸ªå€¼å’Œæ•°æ®æºçš„ &quot;done&quot; çŠ¶æ€å¿…é¡»å·²çŸ¥ï¼Œæ‰€ä»¥è¿­ä»£å™¨åªé€‚åˆäºè¡¨ç¤º<strong>åŒæ­¥</strong>æ•°æ®æºã€‚</p> <p>è™½ç„¶ JavaScript ç¨‹åºå‘˜é‡åˆ°çš„è®¸å¤šæ•°æ®æºæ˜¯åŒæ­¥çš„ï¼ˆæ¯”å¦‚å†…å­˜ä¸­çš„åˆ—è¡¨å’Œå…¶ä»–æ•°æ®ç»“æ„ï¼‰ï¼Œä½†æ˜¯å…¶ä»–è®¸å¤šæ•°æ®æºå´ä¸æ˜¯ã€‚ä¾‹å¦‚ï¼Œä»»ä½•éœ€è¦ I/O è®¿é—®çš„æ•°æ®æºé€šå¸¸éƒ½ä¼šä½¿ç”¨åŸºäºäº‹ä»¶çš„æˆ–æµå¼å¼‚æ­¥ API æ¥è¡¨ç¤ºã€‚ä¸å¹¸çš„æ˜¯ï¼Œè¿­ä»£å™¨ä¸èƒ½ç”¨æ¥è¡¨ç¤ºè¿™æ ·çš„æ•°æ®æºã€‚</p> <p>ï¼ˆå³ä½¿æ˜¯ promise çš„è¿­ä»£å™¨ä¹Ÿæ˜¯ä¸å¤Ÿçš„ï¼Œå› ä¸ºå®ƒçš„ value æ˜¯å¼‚æ­¥çš„ï¼Œä½†æ˜¯è¿­ä»£å™¨éœ€è¦åŒæ­¥ç¡®å®š &quot;done&quot; çŠ¶æ€ã€‚ï¼‰</p> <p>ä¸ºäº†ç»™å¼‚æ­¥æ•°æ®æºæä¾›é€šç”¨çš„æ•°æ®è®¿é—®åè®®ï¼Œæˆ‘ä»¬å¼•å…¥äº† <code>AsyncIterator</code> æ¥å£ï¼Œå¼‚æ­¥è¿­ä»£è¯­å¥ï¼ˆ <code>for-await-of</code>ï¼‰å’Œå¼‚æ­¥ç”Ÿæˆå™¨å‡½æ•°ã€‚</p> <h2 id="_4-å¼‚æ­¥è¿­ä»£å™¨"><a href="#_4-å¼‚æ­¥è¿­ä»£å™¨" aria-hidden="true" class="header-anchor">#</a> 4. å¼‚æ­¥è¿­ä»£å™¨</h2> <p>ä¸€ä¸ªå¼‚æ­¥è¿­ä»£å™¨å°±åƒä¸€ä¸ªè¿­ä»£å™¨ï¼Œé™¤äº†å®ƒçš„ <code>next()</code> æ–¹æ³•è¿”å›ä¸€ä¸ª <code>{value,done}</code> çš„ promiseã€‚å¦‚ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬å¿…é¡»è¿”å›è¿­ä»£å™¨ç»“æœçš„ promiseï¼Œå› ä¸ºåœ¨è¿­ä»£å™¨æ–¹æ³•è¿”å›æ—¶ï¼Œè¿­ä»£å™¨çš„ä¸‹ä¸€ä¸ªå€¼å’Œâ€œå®Œæˆâ€çŠ¶æ€å¯èƒ½æœªçŸ¥ã€‚</p> <p>æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹ä¹‹å‰çš„ä»£ç ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code> const justjavac = {-  [Symbol.iterator]: () =&gt; {+  [Symbol.asyncIterator]: () =&gt; {     const items = [`j`, `u`, `s`, `t`, `j`, `a`, `v`, `a`, `c`];     return {-      next: () =&gt; ({+      next: () =&gt; Promise.resolve({         done: items.length === 0,         value: items.shift()       })     }   } }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>å¥½çš„ï¼Œæˆ‘ä»¬ç°åœ¨æœ‰äº†ä¸€ä¸ªå¼‚æ­¥è¿­ä»£å™¨ï¼Œä»£ç å¦‚ä¸‹ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>const justjavac = {  [Symbol.asyncIterator]: () =&gt; {    const items = [`j`, `u`, `s`, `t`, `j`, `a`, `v`, `a`, `c`];    return {      next: () =&gt; Promise.resolve({        done: items.length === 0,        value: items.shift()      })    }  }}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦‚ä¸‹ä»£ç è¿›è¡Œéå†ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>for await (const item of justjavac) {  console.log(item)}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>å¦‚æœä½ é‡åˆ°äº† <code>SyntaxError:forawait(...of...)isonly validinasyncfunctionsandasyncgenerators</code> é”™è¯¯ï¼Œé‚£æ˜¯å› ä¸º <code>for-await-of</code> åªèƒ½åœ¨ async å‡½æ•°æˆ–è€… async ç”Ÿæˆå™¨é‡Œé¢ä½¿ç”¨ã€‚</p> <p>ä¿®æ”¹ä¸€ä¸‹ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>(async function(){  for await (const item of justjavac) {    console.log(item)  }})();
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="_5-åŒæ­¥è¿­ä»£å™¨-vs-å¼‚æ­¥è¿­ä»£å™¨"><a href="#_5-åŒæ­¥è¿­ä»£å™¨-vs-å¼‚æ­¥è¿­ä»£å™¨" aria-hidden="true" class="header-anchor">#</a> 5. åŒæ­¥è¿­ä»£å™¨ vs å¼‚æ­¥è¿­ä»£å™¨</h2> <h3 id="_5-1-iterators"><a href="#_5-1-iterators" aria-hidden="true" class="header-anchor">#</a> 5.1 Iterators</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>// è¿­ä»£å™¨interface Iterator {    next(value) : IteratorResult;    [optional] throw(value) : IteratorResult;    [optional] return(value) : IteratorResult;}// è¿­ä»£ç»“æœinterface IteratorResult {    value : any;    done : bool;}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_5-2-async-iterators"><a href="#_5-2-async-iterators" aria-hidden="true" class="header-anchor">#</a> 5.2 Async Iterators</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>// å¼‚æ­¥è¿­ä»£å™¨interface AsyncIterator {    next(value) : Promise&lt;IteratorResult&gt;;    [optional] throw(value) : Promise&lt;IteratorResult&gt;;    [optional] return(value) : Promise&lt;IteratorResult&gt;;}// è¿­ä»£ç»“æœinterface IteratorResult {    value : any;    done : bool;}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="_6-å¼‚æ­¥ç”Ÿæˆå™¨å‡½æ•°"><a href="#_6-å¼‚æ­¥ç”Ÿæˆå™¨å‡½æ•°" aria-hidden="true" class="header-anchor">#</a> 6. å¼‚æ­¥ç”Ÿæˆå™¨å‡½æ•°</h2> <p>å¼‚æ­¥ç”Ÿæˆå™¨å‡½æ•°ä¸ç”Ÿæˆå™¨å‡½æ•°ç±»ä¼¼ï¼Œä½†æœ‰ä»¥ä¸‹åŒºåˆ«ï¼š</p> <ul><li>å½“è¢«è°ƒç”¨æ—¶ï¼Œå¼‚æ­¥ç”Ÿæˆå™¨å‡½æ•°è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œ&quot;async generator&quot;ï¼Œå«æœ‰ 3 ä¸ªæ–¹æ³•ï¼ˆ <code>next</code>ï¼Œ <code>throw</code>ï¼Œå’Œ <code>return</code>ï¼‰ï¼Œæ¯ä¸ªæ–¹æ³•éƒ½è¿”å›ä¸€ä¸ª Promiseï¼ŒPromise è¿”å› <code>{value,done}</code>ã€‚è€Œæ™®é€šç”Ÿæˆå™¨å‡½æ•°å¹¶ä¸è¿”å› Promiseï¼Œè€Œæ˜¯ç›´æ¥è¿”å› <code>{value,done}</code>ã€‚è¿™ä¼šè‡ªåŠ¨ä½¿è¿”å›çš„å¼‚æ­¥ç”Ÿæˆå™¨å¯¹è±¡å…·æœ‰å¼‚æ­¥è¿­ä»£çš„åŠŸèƒ½ã€‚</li> <li>å…è®¸ä½¿ç”¨ <code>await</code> è¡¨è¾¾å¼å’Œ <code>for-await-of</code> è¯­å¥ã€‚</li> <li>ä¿®æ”¹äº† <code>yield*</code> çš„è¡Œä¸ºä»¥æ”¯æŒå¼‚æ­¥è¿­ä»£ã€‚</li></ul> <p>ç¤ºä¾‹ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>async function* readLines(path) {  let file = await fileOpen(path);  try {    while (!file.EOF) {      yield await file.readLine();    }  } finally {    await file.close();  }}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>å‡½æ•°è¿”å›ä¸€ä¸ªå¼‚æ­¥ç”Ÿæˆå™¨ï¼ˆasync generatorï¼‰å¯¹è±¡ï¼Œå¯ä»¥ç”¨åœ¨ <code>for-await-of</code> è¯­å¥ä¸­ã€‚</p> <h2 id="_7-å®ç°"><a href="#_7-å®ç°" aria-hidden="true" class="header-anchor">#</a> 7. å®ç°</h2> <ul><li>Chakra - æš‚æœªæ”¯æŒ</li> <li>JavaScriptCore - Safari Tech Preview 40</li> <li>SpiderMonkey - Firefox 57</li> <li>V8 - Chrome 63</li></ul> <h2 id="polyfills"><a href="#polyfills" aria-hidden="true" class="header-anchor">#</a> Polyfills</h2> <p>Facebook çš„ Regenerator é¡¹ç›®ä¸º <code>AsyncIterator</code> æ¥å£æä¾›äº†ä¸€ä¸ª polyfillï¼Œå°†å¼‚æ­¥ç”Ÿæˆå™¨å‡½æ•°å˜æˆè¿”å› <code>AsyncIterator</code> çš„å¯¹è±¡ ECMAScript 5 å‡½æ•°ã€‚Regenerator è¿˜ä¸æ”¯æŒ <code>for-await-of</code> å¼‚æ­¥è¿­ä»£è¯­æ³•ã€‚</p> <p>Babylon parser é¡¹ç›®æ”¯æŒå¼‚æ­¥ç”Ÿæˆå™¨å‡½æ•°å’Œ <code>for-await-of</code> è¯­å¥ï¼ˆv6.8.0+ï¼‰ã€‚ä½ å¯ä»¥ä½¿ç”¨å®ƒçš„ asyncGenerators æ’ä»¶ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>require(&quot;babylon&quot;).parse(&quot;code&quot;, {  sourceType: &quot;module&quot;,  plugins: [    &quot;asyncGenerators&quot;  ]});
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>å¦å¤–ï¼Œä» 6.16.0 å¼€å§‹ï¼Œå¼‚æ­¥è¿­ä»£è¢«åŒ…å«åœ¨ Babel çš„ <code>&quot;babel-plugin-transform-async-generator-functions&quot;</code> ä¸‹ä»¥åŠ <code>babel-preset-stage-3</code>ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>require(&quot;babel-core&quot;).transform(&quot;code&quot;, {  plugins: [    &quot;transform-async-generator-functions&quot;  ]});
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">9/17/2018, 5:48:19 PM</span></div></div> <!----> </div> <!----></div></div>
    <script src="/Blog/assets/js/13.1af90041.js" defer></script><script src="/Blog/assets/js/app.b624378b.js" defer></script>
  </body>
</html>

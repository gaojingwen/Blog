<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>用 Node.js 的 16 行代码创建一个简单的天气 App | 小三胖技术栈</title>
    <meta name="description" content="佛系前端大神">
    <meta charset="UTF-8">
  <link rel="icon" href="/Blog/favicon.ico">
    
    <link rel="preload" href="/Blog/assets/css/0.styles.9ba1bd5b.css" as="style"><link rel="preload" href="/Blog/assets/js/app.b624378b.js" as="script"><link rel="preload" href="/Blog/assets/js/32.b715a23d.js" as="script"><link rel="prefetch" href="/Blog/assets/js/25.812a025f.js"><link rel="prefetch" href="/Blog/assets/js/2.6f79cb1b.js"><link rel="prefetch" href="/Blog/assets/js/3.d16a0c2c.js"><link rel="prefetch" href="/Blog/assets/js/4.981975ce.js"><link rel="prefetch" href="/Blog/assets/js/5.22251c73.js"><link rel="prefetch" href="/Blog/assets/js/6.628e770d.js"><link rel="prefetch" href="/Blog/assets/js/7.07e2b6b4.js"><link rel="prefetch" href="/Blog/assets/js/8.2bccae8e.js"><link rel="prefetch" href="/Blog/assets/js/9.5fab895e.js"><link rel="prefetch" href="/Blog/assets/js/10.322ce4df.js"><link rel="prefetch" href="/Blog/assets/js/11.006e4719.js"><link rel="prefetch" href="/Blog/assets/js/12.3333e057.js"><link rel="prefetch" href="/Blog/assets/js/13.1af90041.js"><link rel="prefetch" href="/Blog/assets/js/14.182c46a3.js"><link rel="prefetch" href="/Blog/assets/js/15.1cbbb4a1.js"><link rel="prefetch" href="/Blog/assets/js/16.49b9f0b6.js"><link rel="prefetch" href="/Blog/assets/js/17.29b175e7.js"><link rel="prefetch" href="/Blog/assets/js/18.297427c5.js"><link rel="prefetch" href="/Blog/assets/js/19.2663f562.js"><link rel="prefetch" href="/Blog/assets/js/20.b7420290.js"><link rel="prefetch" href="/Blog/assets/js/21.d39c8908.js"><link rel="prefetch" href="/Blog/assets/js/22.f1126d66.js"><link rel="prefetch" href="/Blog/assets/js/23.4a7a29be.js"><link rel="prefetch" href="/Blog/assets/js/24.e6bca216.js"><link rel="prefetch" href="/Blog/assets/js/26.9960f054.js"><link rel="prefetch" href="/Blog/assets/js/27.fc3fad79.js"><link rel="prefetch" href="/Blog/assets/js/28.cd83fc3d.js"><link rel="prefetch" href="/Blog/assets/js/29.443e4941.js"><link rel="prefetch" href="/Blog/assets/js/30.6a8a17b9.js"><link rel="prefetch" href="/Blog/assets/js/31.8fc47db9.js"><link rel="prefetch" href="/Blog/assets/js/33.518efbd0.js"><link rel="prefetch" href="/Blog/assets/js/34.76e7b1b1.js"><link rel="prefetch" href="/Blog/assets/js/35.f8a6b00b.js"><link rel="prefetch" href="/Blog/assets/js/36.8c12af51.js"><link rel="prefetch" href="/Blog/assets/js/37.cda5ca1d.js"><link rel="prefetch" href="/Blog/assets/js/38.60935ef0.js"><link rel="prefetch" href="/Blog/assets/js/39.26c637dd.js"><link rel="prefetch" href="/Blog/assets/js/40.44a0bfa7.js"><link rel="prefetch" href="/Blog/assets/js/41.259d1527.js"><link rel="prefetch" href="/Blog/assets/js/42.ab80d836.js"><link rel="prefetch" href="/Blog/assets/js/43.0af190a7.js"><link rel="prefetch" href="/Blog/assets/js/44.093f7743.js"><link rel="prefetch" href="/Blog/assets/js/45.8c17580f.js"><link rel="prefetch" href="/Blog/assets/js/46.fd30eace.js"><link rel="prefetch" href="/Blog/assets/js/47.214dd0f8.js"><link rel="prefetch" href="/Blog/assets/js/48.d43dc2ae.js"><link rel="prefetch" href="/Blog/assets/js/49.6136b23c.js"><link rel="prefetch" href="/Blog/assets/js/50.fd4e81e2.js"><link rel="prefetch" href="/Blog/assets/js/51.9fa346c5.js"><link rel="prefetch" href="/Blog/assets/js/52.6e5d9385.js"><link rel="prefetch" href="/Blog/assets/js/53.19db09c4.js">
    <link rel="stylesheet" href="/Blog/assets/css/0.styles.9ba1bd5b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Blog/" class="home-link router-link-active"><!----> <span class="site-name">小三胖技术栈</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Blog/recondRESUME/" class="nav-link">Resume</a></div><div class="nav-item"><a href="/Blog/recondCSS/" class="nav-link">Css</a></div><div class="nav-item"><a href="/Blog/recondJAVASCRIPT/" class="nav-link">Javascript</a></div><div class="nav-item"><a href="/Blog/recondVUE/" class="nav-link">Vue</a></div><div class="nav-item"><a href="/Blog/recondNODE/" class="nav-link router-link-active">Node</a></div><div class="nav-item"><a href="/Blog/recondES6/" class="nav-link">Es6</a></div><div class="nav-item"><a href="/Blog/recondPROJECT/" class="nav-link">projectify</a></div><div class="nav-item"><a href="/Blog/recondSUMMARY/" class="nav-link">summary</a></div><div class="nav-item"><a href="/Blog/recondFEATURE/" class="nav-link">feature</a></div><div class="nav-item"><a href="/Blog/recondGIT/" class="nav-link">git</a></div><div class="nav-item"><a href="/Blog/recondOTHER/" class="nav-link">other</a></div><div class="nav-item"><a href="https://github.com/gaojingwen" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub地址
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Blog/recondRESUME/" class="nav-link">Resume</a></div><div class="nav-item"><a href="/Blog/recondCSS/" class="nav-link">Css</a></div><div class="nav-item"><a href="/Blog/recondJAVASCRIPT/" class="nav-link">Javascript</a></div><div class="nav-item"><a href="/Blog/recondVUE/" class="nav-link">Vue</a></div><div class="nav-item"><a href="/Blog/recondNODE/" class="nav-link router-link-active">Node</a></div><div class="nav-item"><a href="/Blog/recondES6/" class="nav-link">Es6</a></div><div class="nav-item"><a href="/Blog/recondPROJECT/" class="nav-link">projectify</a></div><div class="nav-item"><a href="/Blog/recondSUMMARY/" class="nav-link">summary</a></div><div class="nav-item"><a href="/Blog/recondFEATURE/" class="nav-link">feature</a></div><div class="nav-item"><a href="/Blog/recondGIT/" class="nav-link">git</a></div><div class="nav-item"><a href="/Blog/recondOTHER/" class="nav-link">other</a></div><div class="nav-item"><a href="https://github.com/gaojingwen" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub地址
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>Node</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/Blog/recondNODE/" class="sidebar-link">大笨蛋</a></li><li><a href="/Blog/recondNODE/《Node.js设计模式》使用流进行编码.html" class="sidebar-link">《Node.js设计模式》使用流进行编码</a></li><li><a href="/Blog/recondNODE/用 Node.js 的 16 行代码创建一个简单的天气 App.html" class="active sidebar-link">用 Node.js 的 16 行代码创建一个简单的天气 App</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="用-node-js-的-16-行代码创建一个简单的天气-app"><a href="#用-node-js-的-16-行代码创建一个简单的天气-app" aria-hidden="true" class="header-anchor">#</a> 用 Node.js 的 16 行代码创建一个简单的天气 App</h1> <p>景朝阳 [AutoCFE](javascript:void(0)😉 <em>2017-09-01</em></p> <p>原文地址：https://codeburst.io/build-a-simple-weather-app-with-node-js-in-just-16-lines-of-code-32261690901d</p> <p>仅15分钟学会使用 API 调用并建立一个命令行天气应用程序。</p> <p>本教程的范围</p> <p>欢迎！这是多篇教程中的第一篇文章！</p> <p>在本教程中,您将学习如何调</p> <p>用 OpenWeatherMap.org API 并把结果输出到控制台。</p> <p>- 20 秒快速注册 OpenWeatherMap.org 账户。</p> <p>- Node.js : 如果没有安装 Node，请到官网 Node.js website 下载并安装。如果这样的项目你感兴趣并且你也在寻找 Node 更深入的教程请查看另一篇文章 Top Three Node.js courses</p> <p>第一步：OpenWeatherMap</p> <p>当你想玩玩 API ，OpenWeatherMap 是一个不错的地方。实际上有关于天气的11种不同的api供您访问。</p> <p>对于这个项目我们将使用免费的 Current Weather API, 点击此处注册账号。</p> <p>登陆之后， 点击 API keys, 在页面的右侧你可以创建一个 key，输入一个名称(任何)并选择生成。在页面左侧可以看到生成的 API Key。</p> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/gb0VkRWbm2PyX0Yic6WOSciciaibUe1K1tOdNuU6ANS5l6IUupKxOwibMvaWicKNlvpBN5Mxc3v5RLHMKAiboYahZlorw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="img"></p> <p>太棒了,现在我们有API密匙，可以开始创建我们的应用程序。</p> <p>第二步：Setting up the project</p> <p>\1. 创建 node-weather 文件夹然后执行：</p> <p>npm init</p> <p>\2. 填写所需的信息来初始化我们的项目</p> <p>以下是我的 package.json 文件初始化后的样子。</p> <p>注意:你本地的跟我的看起来略有不同,没关系。</p> <p>{</p> <p>&quot;name&quot;: &quot;simple-nodejs-weather-app&quot;,</p> <p>&quot;version&quot;: &quot;1.0.0&quot;,</p> <p>&quot;description&quot;: &quot;&quot;,</p> <p>&quot;main&quot;: &quot;index.js&quot;,</p> <p>&quot;scripts&quot;: {</p> <p>​    &quot;test&quot;: &quot;echo &quot;Error: no test specified&quot; &amp;&amp; exit 1&quot;</p> <p>},</p> <p>&quot;repository&quot;: {</p> <p>​    &quot;type&quot;: &quot;git&quot;,</p> <p>​    &quot;url&quot;: &quot;git+https://github.com/bmorelli25/simple-nodejs-weather-app.git&quot;</p> <p>},</p> <p>&quot;author&quot;: &quot;brandon morelli&quot;,</p> <p>&quot;license&quot;: &quot;ISC&quot;,</p> <p>&quot;bugs&quot;: {</p> <p>​    &quot;url&quot;: &quot;https://github.com/bmorelli25/simple-nodejs-weather-app/issues&quot;</p> <p>},</p> <p>&quot;homepage&quot;: &quot;https://github.com/bmorelli25/simple-nodejs-weather-app#readme&quot;,</p> <p>&quot;dependencies&quot;: {</p> <p>}</p> <p>}</p> <p>\3.  创建 index.js 文件，此文件将包含应用程序的代码。</p> <p>Making the API call</p> <p>API调用，我们将使用一个受欢迎的npm模块 request 调用。 request 已经有数以百万的下载，是一个简化 http 请求的模块。</p> <p>npm install request --save</p> <p>就像我说的, request 很容易使用。我们只需要传惨 url，request 返回一个回调函数。</p> <p>const request = require('request');</p> <p>request(url, function (err, response, body) {</p> <p>if(err){</p> <p>​    console.log('error:', error);</p> <p>} else {</p> <p>​    console.log('body:', body);</p> <p>}</p> <p>});</p> <p>让我们分解这个代码</p> <p>\1. 引入 request 包</p> <p>\2. 传 url ，request 返回一个回调函数，其中参数为 err 、 response 、body</p> <p>\3. 在请求中检查错误， 如果有 error ，输出到控制台</p> <p>\4. 如果没有 error, 将 body 输出。</p> <p>太棒啦，不过 url 是什么呢？</p> <p>通过阅读OpenWeatherMap(https://openweathermap.org/current)  文档，能够确定 url 是什么。http://api.openweathermap.org/data/2.5/weather 需要两个必须的参数。已键值对形式通过 url 传递城市以及 API Key 。</p> <p>let apiKey = '****************************';</p> <p>let city = 'portland';</p> <p>let url = <code>http://api.openweathermap.org/data/2.5/weather?q=${city}&amp;appid=${apiKey}</code></p> <p>上述代码做了3件事</p> <p>\1. 声明变量 apiKey 存放 API Key</p> <p>\2. 声明变量  city 存放城市。</p> <p>\3. 声明变量 url 存放接口地址，? 后面是查询参数，以 key = value 形式存在，不同参数间以 &amp; 连接</p> <p>代码整合后如下：</p> <p>let request = require('request');</p> <p>let apiKey = '*****************************';</p> <p>let city = 'portland';</p> <p>let url = <code>http://api.openweathermap.org/data/2.5/weather?q=${city}&amp;appid=${apiKey}</code></p> <p>request(url, function (err, response, body) {</p> <p>if(err){</p> <p>​    console.log('error:', error);</p> <p>} else {</p> <p>​    console.log('body:', body);</p> <p>}</p> <p>});</p> <p>控制台输入运行代码：</p> <p>node index.js</p> <p>// the following is returned:</p> <p>body: {&quot;coord&quot;:{&quot;lon&quot;:-122.68,&quot;lat&quot;:45.52},&quot;weather&quot;:  [{&quot;id&quot;:801,&quot;main&quot;:&quot;Clouds&quot;,&quot;description&quot;:&quot;few clouds&quot;,&quot;icon&quot;:&quot;02d&quot;}],&quot;base&quot;:&quot;stations&quot;,&quot;main&quot;:{&quot;temp&quot;:302.15,&quot;pressure&quot;:1014,&quot;humidity&quot;:51,&quot;temp_min&quot;:301.15,&quot;temp_max&quot;:303.15},&quot;visibility&quot;:16093,&quot;wind&quot;:{&quot;speed&quot;:2.6,&quot;deg&quot;:320},&quot;clouds&quot;:{&quot;all&quot;:20},&quot;dt&quot;:1497905580,&quot;sys&quot;:{&quot;type&quot;:1,&quot;id&quot;:2274,&quot;message&quot;:0.0042,&quot;country&quot;:&quot;US&quot;,&quot;sunrise&quot;:1497874905,&quot;sunset&quot;:1497931383},&quot;id&quot;:5746545,&quot;name&quot;:&quot;Portland&quot;,&quot;cod&quot;:200}</p> <p>我们成功的请求了 OpenWeatherMap’s API 并返回了数据。数据里有好多信息，比如 温度、湿度、风速等等</p> <p>重要提示：你永远不会像这样在你的代码中公开你的API密钥。为了简洁起见，我像这样把它放在公开的地方。在以后的教程中，我将向您展示如何使用环境变量隐藏 API 。现在，只需要知道像这样公开 API 密钥是不标准的。</p> <p>整理返回数据</p> <p>这个应用程序还不能用。返回的数据混乱杂乱令人讨厌。让我们把整理下。</p> <p>我们需要做的第一件事是将返回字符串 json 转换成 JavaScript 对象。</p> <p>我们用以下代码转换：</p> <p>let weather = JSON.parse(body)</p> <p>现在我们有了 JavaScript 对象，我们可以用点或括号符号来访问对象中的数据。下面，我们通过访问天气对象中的数据构造消息字符串。</p> <p>let message = <code>It's ${weather.main.temp} degrees in${weather.name}!</code>;</p> <p>console.log(message);</p> <p>执行程序，输出如下：</p> <p>node index.js</p> <p>// It's 300.4 degrees in Portland</p> <p>稍等。程序没有错，OpenWeatherMap  默认返回 Kelvin 温度。如果需要华氏温度添加参数 units=imperial。</p> <p>执行代码：</p> <p>node index.js</p> <p>// It's 70.1 degrees in Portland</p> <p>修改后代码如下：</p> <p>let request = require('request');</p> <p>let apiKey = '***********************************';</p> <p>let city = 'portland';</p> <p>let url = <code>http://api.openweathermap.org/data/2.5/weather?q=${city}&amp;units=imperial&amp;appid=${apiKey}</code></p> <p>request(url, function (err, response, body) {</p> <p>if(err){</p> <p>​    console.log('error:', error);</p> <p>} else {</p> <p>​    let weather = JSON.parse(body)</p> <p>​    let message = <code>It's ${weather.main.temp} degrees in ${weather.name}!</code>;</p> <p>​    console.log(message);</p> <p>}</p> <p>});</p> <p>添加交互性</p> <p>我们的应用程序仍然很无聊。我们只能访问波特兰俄勒冈的天气。让我们添加一些互动。为此，我们将使用yargs(https://www.npmjs.com/package/yargs)。 Yargs是交互式命令行接口工具。或者更简单地说，它允许我们从命令行定义变量。</p> <p>安装 yargs :</p> <p>npm install yargs --save</p> <p>yargs 将控制台输入的变量放在 argv 对象里。我们设置和访问这个对象如下：</p> <p>const argv = require('yargs').argv;</p> <p>我们将使用 c 表示城市:</p> <p>修改 city 变量为 argv.c 。如果没有输入变量，默认为 Portland 。如下：</p> <p>let city = argv.c || 'portland';</p> <p>运行程序:</p> <p>node index.js</p> <p>我们需要传递一个名为 c 的变量，如下所示</p> <p>node index.js -c Boston</p> <p>// It's 85 degrees in Boston</p> <p>我们使用一个标志表示传递的变量。因为我们将变量设置为字母 c，所以我们用 c 传递变量。c 后面可以跟任何我们想要的城市名称！</p> <p>node index.js -c Anchorage</p> <p>// It's 47 degrees in Anchorage</p> <p>在这一点上，我们的代码入下：</p> <p>const request = require('request');</p> <p>const argv = require('yargs').argv;</p> <p>let apiKey = '*****************************';</p> <p>let city = argv.c || 'portland';</p> <p>let url = <code>http://api.openweathermap.org/data/2.5/weather?q=${city}&amp;units=imperial&amp;appid=${apiKey}</code></p> <p>request(url, function (err, response, body) {</p> <p>if(err){</p> <p>​    console.log('error:', error);</p> <p>} else {</p> <p>​    let weather = JSON.parse(body)</p> <p>​    let message = <code>It's ${weather.main.temp} degrees in ${weather.name}!</code>;</p> <p>​    console.log(message);</p> <p>}</p> <p>});</p> <p>你做到了！</p></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">9/17/2018, 5:48:19 PM</span></div></div> <!----> </div> <!----></div></div>
    <script src="/Blog/assets/js/32.b715a23d.js" defer></script><script src="/Blog/assets/js/app.b624378b.js" defer></script>
  </body>
</html>

<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>vue2.0 项目开发小结 | 小三胖技术栈</title>
    <meta name="description" content="佛系前端大神">
    <meta charset="UTF-8">
  <link rel="icon" href="/Blog/favicon.ico">
    
    <link rel="preload" href="/Blog/assets/css/0.styles.9ba1bd5b.css" as="style"><link rel="preload" href="/Blog/assets/js/app.b624378b.js" as="script"><link rel="preload" href="/Blog/assets/js/50.fd4e81e2.js" as="script"><link rel="prefetch" href="/Blog/assets/js/25.812a025f.js"><link rel="prefetch" href="/Blog/assets/js/2.6f79cb1b.js"><link rel="prefetch" href="/Blog/assets/js/3.d16a0c2c.js"><link rel="prefetch" href="/Blog/assets/js/4.981975ce.js"><link rel="prefetch" href="/Blog/assets/js/5.22251c73.js"><link rel="prefetch" href="/Blog/assets/js/6.628e770d.js"><link rel="prefetch" href="/Blog/assets/js/7.07e2b6b4.js"><link rel="prefetch" href="/Blog/assets/js/8.2bccae8e.js"><link rel="prefetch" href="/Blog/assets/js/9.5fab895e.js"><link rel="prefetch" href="/Blog/assets/js/10.322ce4df.js"><link rel="prefetch" href="/Blog/assets/js/11.006e4719.js"><link rel="prefetch" href="/Blog/assets/js/12.3333e057.js"><link rel="prefetch" href="/Blog/assets/js/13.1af90041.js"><link rel="prefetch" href="/Blog/assets/js/14.182c46a3.js"><link rel="prefetch" href="/Blog/assets/js/15.1cbbb4a1.js"><link rel="prefetch" href="/Blog/assets/js/16.49b9f0b6.js"><link rel="prefetch" href="/Blog/assets/js/17.29b175e7.js"><link rel="prefetch" href="/Blog/assets/js/18.297427c5.js"><link rel="prefetch" href="/Blog/assets/js/19.2663f562.js"><link rel="prefetch" href="/Blog/assets/js/20.b7420290.js"><link rel="prefetch" href="/Blog/assets/js/21.d39c8908.js"><link rel="prefetch" href="/Blog/assets/js/22.f1126d66.js"><link rel="prefetch" href="/Blog/assets/js/23.4a7a29be.js"><link rel="prefetch" href="/Blog/assets/js/24.e6bca216.js"><link rel="prefetch" href="/Blog/assets/js/26.9960f054.js"><link rel="prefetch" href="/Blog/assets/js/27.fc3fad79.js"><link rel="prefetch" href="/Blog/assets/js/28.cd83fc3d.js"><link rel="prefetch" href="/Blog/assets/js/29.443e4941.js"><link rel="prefetch" href="/Blog/assets/js/30.6a8a17b9.js"><link rel="prefetch" href="/Blog/assets/js/31.8fc47db9.js"><link rel="prefetch" href="/Blog/assets/js/32.b715a23d.js"><link rel="prefetch" href="/Blog/assets/js/33.518efbd0.js"><link rel="prefetch" href="/Blog/assets/js/34.76e7b1b1.js"><link rel="prefetch" href="/Blog/assets/js/35.f8a6b00b.js"><link rel="prefetch" href="/Blog/assets/js/36.8c12af51.js"><link rel="prefetch" href="/Blog/assets/js/37.cda5ca1d.js"><link rel="prefetch" href="/Blog/assets/js/38.60935ef0.js"><link rel="prefetch" href="/Blog/assets/js/39.26c637dd.js"><link rel="prefetch" href="/Blog/assets/js/40.44a0bfa7.js"><link rel="prefetch" href="/Blog/assets/js/41.259d1527.js"><link rel="prefetch" href="/Blog/assets/js/42.ab80d836.js"><link rel="prefetch" href="/Blog/assets/js/43.0af190a7.js"><link rel="prefetch" href="/Blog/assets/js/44.093f7743.js"><link rel="prefetch" href="/Blog/assets/js/45.8c17580f.js"><link rel="prefetch" href="/Blog/assets/js/46.fd30eace.js"><link rel="prefetch" href="/Blog/assets/js/47.214dd0f8.js"><link rel="prefetch" href="/Blog/assets/js/48.d43dc2ae.js"><link rel="prefetch" href="/Blog/assets/js/49.6136b23c.js"><link rel="prefetch" href="/Blog/assets/js/51.9fa346c5.js"><link rel="prefetch" href="/Blog/assets/js/52.6e5d9385.js"><link rel="prefetch" href="/Blog/assets/js/53.19db09c4.js">
    <link rel="stylesheet" href="/Blog/assets/css/0.styles.9ba1bd5b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Blog/" class="home-link router-link-active"><!----> <span class="site-name">小三胖技术栈</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Blog/recondRESUME/" class="nav-link">Resume</a></div><div class="nav-item"><a href="/Blog/recondCSS/" class="nav-link">Css</a></div><div class="nav-item"><a href="/Blog/recondJAVASCRIPT/" class="nav-link">Javascript</a></div><div class="nav-item"><a href="/Blog/recondVUE/" class="nav-link router-link-active">Vue</a></div><div class="nav-item"><a href="/Blog/recondNODE/" class="nav-link">Node</a></div><div class="nav-item"><a href="/Blog/recondES6/" class="nav-link">Es6</a></div><div class="nav-item"><a href="/Blog/recondPROJECT/" class="nav-link">projectify</a></div><div class="nav-item"><a href="/Blog/recondSUMMARY/" class="nav-link">summary</a></div><div class="nav-item"><a href="/Blog/recondFEATURE/" class="nav-link">feature</a></div><div class="nav-item"><a href="/Blog/recondGIT/" class="nav-link">git</a></div><div class="nav-item"><a href="/Blog/recondOTHER/" class="nav-link">other</a></div><div class="nav-item"><a href="https://github.com/gaojingwen" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub地址
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Blog/recondRESUME/" class="nav-link">Resume</a></div><div class="nav-item"><a href="/Blog/recondCSS/" class="nav-link">Css</a></div><div class="nav-item"><a href="/Blog/recondJAVASCRIPT/" class="nav-link">Javascript</a></div><div class="nav-item"><a href="/Blog/recondVUE/" class="nav-link router-link-active">Vue</a></div><div class="nav-item"><a href="/Blog/recondNODE/" class="nav-link">Node</a></div><div class="nav-item"><a href="/Blog/recondES6/" class="nav-link">Es6</a></div><div class="nav-item"><a href="/Blog/recondPROJECT/" class="nav-link">projectify</a></div><div class="nav-item"><a href="/Blog/recondSUMMARY/" class="nav-link">summary</a></div><div class="nav-item"><a href="/Blog/recondFEATURE/" class="nav-link">feature</a></div><div class="nav-item"><a href="/Blog/recondGIT/" class="nav-link">git</a></div><div class="nav-item"><a href="/Blog/recondOTHER/" class="nav-link">other</a></div><div class="nav-item"><a href="https://github.com/gaojingwen" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub地址
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>Vue</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/Blog/recondVUE/" class="sidebar-link">大笨蛋</a></li><li><a href="/Blog/recondVUE/Vue.js最佳实践五招让你成为Vue.js大师.html" class="sidebar-link">Vue.js最佳实践（五招让你成为Vue.js大师）</a></li><li><a href="/Blog/recondVUE/vue2.0 项目开发小结.html" class="active sidebar-link">vue2.0 项目开发小结</a></li><li><a href="/Blog/recondVUE/一套 Vue 的单页模板：N3-admin.html" class="sidebar-link">一套 Vue 的单页模板：N3-admin</a></li><li><a href="/Blog/recondVUE/当前 GitHub 上排名前十的热门 Vue 项目.html" class="sidebar-link">当前 GitHub 上排名前十的热门 Vue 项目</a></li><li><a href="/Blog/recondVUE/手摸手教你搭建一个类Vue文档风格的技术文档.html" class="sidebar-link">VuePress 手摸手教你搭建一个类Vue文档风格的技术文档/博客</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="vue2-0-项目开发小结"><a href="#vue2-0-项目开发小结" aria-hidden="true" class="header-anchor">#</a> vue2.0 项目开发小结</h1> <p>离尘不理人 [SegmentFault](javascript:void(0)😉 <em>2017-09-11</em></p> <h4 id="项目架构"><a href="#项目架构" aria-hidden="true" class="header-anchor">#</a> 项目架构</h4> <p>项目目录</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>├── build├── config├── dist│   └── static│       ├── css│       ├── fonts│       ├── images│       ├── js│       └── lib├── src│   ├── api│   ├── assets│   │   ├── global│   │   └── images│   │       └── footer│   ├── components│   │   ├── common│   │   ├── news│   │   └── profile│   │       └── charge│   ├── config│   ├── mixin│   ├── router│   ├── service│   ├── store│   └── util└── static    ├── images    └── lib 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>项目目录是采用 <code>vue-cli</code> 自动生成，其它按需自己新建就好了。</p> <h4 id="开发实践"><a href="#开发实践" aria-hidden="true" class="header-anchor">#</a> 开发实践</h4> <p><strong>动态修改 document title</strong></p> <p>在不同的路由页面，我们需要动态的修改文档标题，可以将每个页面的标题配置在路由元信息 <code>meta</code> 里面带上，然后在 <code>router.beforeEach</code> 钩子函数中修改：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>import Vue from 'vue';import Router from 'vue-router';Vue.use(Router);const router = new Router({  mode: 'history',  routes: [    { path: '/', component: Index, meta: { title: '推荐产品得丰厚奖金' } },    {      path: '/news',      component: News,      meta: { title: '公告列表' },      children: [        { path: '', redirect: 'list' },        { path: 'list', component: NewsList },        { path: 'detail/:newsId', component: NewsDetail, meta: { title: '公告详情' } }      ]    },    {      path: '/guide',      component: GuideProtocol,      meta: {        title: '新手指南'      }    }  ]});router.beforeEach((to, from, next) =&gt; {  let documentTitle = '商城会员平台';  // path 是多级的，遍历  to.matched.forEach((path) =&gt; {    if (path.meta.title) {      documentTitle += ` - ${path.meta.title}`;    }  });  document.title = documentTitle;  next();});
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>Event Bus 使用场景</strong></p> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/aVp1YC8UV0cHx6kEIFfVV2Jo5lwyicic3pg5bicjq1iaSH7bt0mfYkBicrorUe45UutQ4kxSFMqBUBiclfq1n1kQp7qw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="img"></p> <p>我们在项目中引入了 <code>vuex</code> ，通常情况下是不需要使用 <code>eventbus</code> 的，但是有一种情况下我们需要使用它，那就是在路由钩子函数内部的时，在项目中，我们需要在 <code>beforeEnter</code> 路由钩子里面对外抛出事件，在这个钩子函数中我们无法去到 <code>this</code> 对象。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>beforeEnter: (to, from, next) =&gt; {    const userInfo = localStorage.getItem(userFlag);    if (isPrivateMode()) {        EventBus.$emit('get-localdata-error');        next(false);        return;    }})
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在 <code>App.vue</code> 的 <code>mouted</code> 方法中监听这个事件</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>EventBus.$on('get-localdata-error', () =&gt; {    this.$alert('请勿使用无痕模式浏览');});
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>自定义指令实现埋点数据统计</strong></p> <p>在项目中通常需要做数据埋点，这个时候，使用自定义指令将会变非常简单</p> <p>在项目入口文件 <code>main.js</code> 中配置我们的自定义指令</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// 坑位埋点指令Vue.directive('stat', {  bind(el, binding) {    el.addEventListener('click', () =&gt; {      const data = binding.value;      let prefix = 'store';      if (OS.isAndroid || OS.isPhone) {        prefix = 'mall';      }      analytics.request({        ty: `${prefix}_${data.type}`,        dc: data.desc || ''      }, 'n');    }, false);  }});
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在组件中使用我们的自定义指令</p> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/aVp1YC8UV0cHx6kEIFfVV2Jo5lwyicic3pzNBdN7sHXnFXU4IT1iaGRVJibLqhTYDvr0ia5PzMxRHhWCYeZWXciaETSA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="img"></p> <p><strong>使用过滤器实现展示信息格式化</strong></p> <p>如下图中奖金数据信息，我们需要将后台返回的奖金格式化为带两位小数点的格式，同时，如果返回的金额是区间类型，需要额外加上 起 字和 ￥ 金额符号</p> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/aVp1YC8UV0cHx6kEIFfVV2Jo5lwyicic3pzNBdN7sHXnFXU4IT1iaGRVJibLqhTYDvr0ia5PzMxRHhWCYeZWXciaETSA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="img"></p> <p>在入口文件 <code>main.js</code> 中配置我们自定义的过滤器</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Vue.filter('money', (value, config = { unit: '￥', fixed: 2 }) =&gt; {  const moneyStr = `${value}`;  if (moneyStr.indexOf('-') &gt; -1) {    const scope = moneyStr.split('-');    return `${config.unit}${parseFloat(scope[0]).toFixed(config.fixed).toString()} 起`;  } else if (value === 0) {    return value;  }  return `${config.unit}${parseFloat(moneyStr).toFixed(config.fixed).toString()}`;});
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在组件中使用：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;p class=&quot;price&quot;&gt;{{detail.priceScope | money}}&lt;/p&gt;&lt;div :class=&quot;{singleWrapper: isMobile}&quot;&gt;    &lt;p class=&quot;rate&quot;&gt;比率：{{detail.commissionRateScope}}%&lt;/p&gt;    &lt;p class=&quot;income&quot;&gt;奖金：{{detail.expectedIncome | money}}&lt;/p&gt;&lt;/div&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>axios 使用配置</strong></p> <p>在项目中，我们使用了 axios 做接口请求</p> <p>在项目中全局配置 <code>/api/common.js</code></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>import axios from 'axios';import qs from 'qs';import store from '../store';// 全局默认配置// 设置 POST 请求头axios.defaults.headers.post['Content-Type'] = 'application/x-www-form-urlencoded';// 配置 CORS 跨域axios.defaults.withCredentials = true;axios.defaults.crossDomain = true;// 请求发起前拦截器axios.interceptors.request.use((config) =&gt; {  // 全局 loading 状态，触发 loading 效果  store.dispatch('updateLoadingStatus', {    isLoading: true  });  // POST 请求参数处理成 axios post 方法所需的格式  if (config.method === 'post') {    config.data = qs.stringify(config.data);  }  // 这句不能省，不然后面的请求就无法成功发起，因为读不到配置参数  return config;}, () =&gt; {  // 异常处理  store.dispatch('updateLoadingStatus', {    isLoading: false  });});// 响应拦截axios.interceptors.response.use((response) =&gt; {  // 关闭 loading 效果  store.dispatch('updateLoadingStatus', {    isLoading: false  });  // 全局登录过滤，如果没有登录，直接跳转到登录 URL  if (response.data.code === 300) {    // 未登录    window.location.href = getLoginUrl();    return false;  }  // 这里返回的 response.data 是被 axios 包装过的一成，所以在这里抽取出来  return response.data;}, (error) =&gt; {  store.dispatch('updateLoadingStatus', {    isLoading: false  });  return Promise.reject(error);});// 导出export default axios;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>然后我们在接口中使用就方便很多了 <code>/api/xxx.js</code></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>import axios from './common';const baseURL = '/api/profile';const USER_BASE_INFO = `${baseURL}/getUserBaseInfo.json`;const UPDATE_USER_INFO = `${baseURL}/saveUserInfo.json`;// 更新用户实名认证信息const updateUserInfo = userinfo =&gt; axios.post(UPDATE_USER_INFO, userinfo);// 获取用户基础信息const getUserBaseInfo = () =&gt; axios.get(USER_BASE_INFO);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>vuex 状态在响应式页面中的妙用</strong></p> <p>由于项目是响应式页面，PC 端和移动端在表现成有很多不一致的地方，有时候单单通过 CSS 无法实现交互，这个时候，我们的 <code>vuex</code> 状态就派上用场了，</p> <p>我们一开始在 <code>App.vue</code> 里面监听了页面的 <code>resize</code> 事件，动态的更新 <code>vuex</code> 里面 <code>isMobile</code>的状态值</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>window.onresize = throttle(() =&gt; { this.updatePlatformStatus({   isMobile: isMobile() });}, 500);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>然后，我们在组件层，就能响应式的渲染不同的 <code>dom</code> 结构了。其中最常见的是 PC 端和移动端加载的图片需要不同的规格的，这个时候我们可以这个做</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>methods: {  loadImgAssets(name, suffix = '.jpg') {    return require(`../assets/images/${name}${this.isMobile ? '-mobile' : ''}${suffix}`);  },}&lt;img class=&quot;feed-back&quot; :src=&quot;loadImgAssets('feed-back')&quot;&lt;img v-lazy=&quot;{src: isMobile ? detail.imgUrlMobile : detail.imgUrlPc, loading: placeholder}&quot;&gt;// 动态渲染不同规格的 dislog&lt;el-dialog :visible.sync=&quot;dialogVisible&quot; :size=&quot;isMobile ? 'full' : 'tiny'&quot; top=&quot;30%&quot; custom-class=&quot;unCertification-dialog&quot;&gt;&lt;/el-dialog&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>下图分别是 PC 端和移动短的表现形式，然后配合 CSS 媒体查询实现各种布局</p> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/aVp1YC8UV0cHx6kEIFfVV2Jo5lwyicic3pmib4BBBHvxQnfQDXWx2UQJ6W8ib5wibDHPvNwN1R6hGPgPX8wHdbUM3YA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="img"></p> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/aVp1YC8UV0cHx6kEIFfVV2Jo5lwyicic3p8lbYhfTpia3HI7EKjxwDvfAgvjKmkO3WYQrmUSNLd4y6WnZXATyM2pQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="img"></p> <p>开发相关配置</p> <p><strong>反向代理</strong></p> <p>在项目目录的 <code>config</code> 文件下面的 <code>index.js</code> 配置我们的本地反向代理和端口信息</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>dev: {  env: require('./dev.env'),  port: 80,  autoOpenBrowser: true,  assetsSubDirectory: 'static',  assetsPublicPath: '/',  proxyTable: {    '/api/profile': {      target: '[真实接口地址]:[端口号]', // 例如： http://api.xxx.com      changeOrigin: true,      pathRewrite: {        '^/api/profile': '/profile'      }    }    ...  },
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>然后我们调用接口的形式就会变成如下映射，当我们调用 <code>/api/profile/xxxx</code> 的时候，其实是调用了 <code>[真实接口地址]/profile/xxxx</code></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>/api/profile/xxxx =&gt; [真实接口地址]/profile/xxxx
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>nginx 配置</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>upstream api.xxx.com{ #ip_hash;  server [接口服务器 ip 地址]:[端口];}server {  ...  location ^~ /api/profile {    index index.php index.html index.html;    proxy_redirect off;    proxy_set_header Host $host;    proxy_set_header X-Real-IP $remote_addr;    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;    proxy_pass http://api.xxx.com;    rewrite ^/api/profile/(.*)$ /profile/$1 break;  }  ...}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>线上部署</strong></p> <p>如果路由使用的是 <code>history</code> 模式的话，需要在 <code>nginx</code> 里面配置将所有的请求到转发到 <code>index.html</code> 去</p> <p>在 <code>nginx.conf</code> 或者对应的站点 <code>vhost</code> 文件下面配置</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>location / {    try_files $uri $uri/ /index.html;}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="优化"><a href="#优化" aria-hidden="true" class="header-anchor">#</a> 优化</h4> <p><strong>开启静态资源长缓存</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>location ~ .*\.(gif|jpg|jpeg|png|bmp|swf|woff|ttf|eot|svg)$ {    expires 1y;}location ~ .*\.(js|css)$ {    expires 1y;}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>开启静态资源 gzip 压缩</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// 找到 nginx.conf 配置文件vim /data/nginx/conf/nginx.confgzip on;gzip_min_length  1k;gzip_buffers     4 8k;gzip_http_version 1.1;gzip_types text/plain application/javascript application/x-javascript text/javascript text/xml text/css;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>开启了 gzip 压缩之后，页面资源请求大小将大大减小，如下图所示，表示已经开启了 <code>gzip</code>压缩</p> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/aVp1YC8UV0cHx6kEIFfVV2Jo5lwyicic3pxBIBMrFYgJrpicialrfhgEhhDiarpzWibLBKXJdvONyt6ajFgjXLicqL9ibQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="img"></p> <h4 id="q-a"><a href="#q-a" aria-hidden="true" class="header-anchor">#</a> Q&amp;A</h4> <p>文章到这就结束了，如果有遗漏或者错误的地方，欢迎私信指出。希望这篇文章能带给大家一丝丝收获。</p> <hr></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">9/17/2018, 5:48:19 PM</span></div></div> <!----> </div> <!----></div></div>
    <script src="/Blog/assets/js/50.fd4e81e2.js" defer></script><script src="/Blog/assets/js/app.b624378b.js" defer></script>
  </body>
</html>

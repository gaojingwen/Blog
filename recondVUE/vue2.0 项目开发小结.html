<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>vue2.0 é¡¹ç›®å¼€å‘å°ç»“ | å°ä¸‰èƒ–æŠ€æœ¯æ ˆ</title>
    <meta name="description" content="ä½›ç³»å‰ç«¯å¤§ç¥">
    <meta charset="UTF-8">
  <link rel="icon" href="/Blog/favicon.ico">
    
    <link rel="preload" href="/Blog/assets/css/0.styles.9ba1bd5b.css" as="style"><link rel="preload" href="/Blog/assets/js/app.b624378b.js" as="script"><link rel="preload" href="/Blog/assets/js/50.fd4e81e2.js" as="script"><link rel="prefetch" href="/Blog/assets/js/25.812a025f.js"><link rel="prefetch" href="/Blog/assets/js/2.6f79cb1b.js"><link rel="prefetch" href="/Blog/assets/js/3.d16a0c2c.js"><link rel="prefetch" href="/Blog/assets/js/4.981975ce.js"><link rel="prefetch" href="/Blog/assets/js/5.22251c73.js"><link rel="prefetch" href="/Blog/assets/js/6.628e770d.js"><link rel="prefetch" href="/Blog/assets/js/7.07e2b6b4.js"><link rel="prefetch" href="/Blog/assets/js/8.2bccae8e.js"><link rel="prefetch" href="/Blog/assets/js/9.5fab895e.js"><link rel="prefetch" href="/Blog/assets/js/10.322ce4df.js"><link rel="prefetch" href="/Blog/assets/js/11.006e4719.js"><link rel="prefetch" href="/Blog/assets/js/12.3333e057.js"><link rel="prefetch" href="/Blog/assets/js/13.1af90041.js"><link rel="prefetch" href="/Blog/assets/js/14.182c46a3.js"><link rel="prefetch" href="/Blog/assets/js/15.1cbbb4a1.js"><link rel="prefetch" href="/Blog/assets/js/16.49b9f0b6.js"><link rel="prefetch" href="/Blog/assets/js/17.29b175e7.js"><link rel="prefetch" href="/Blog/assets/js/18.297427c5.js"><link rel="prefetch" href="/Blog/assets/js/19.2663f562.js"><link rel="prefetch" href="/Blog/assets/js/20.b7420290.js"><link rel="prefetch" href="/Blog/assets/js/21.d39c8908.js"><link rel="prefetch" href="/Blog/assets/js/22.f1126d66.js"><link rel="prefetch" href="/Blog/assets/js/23.4a7a29be.js"><link rel="prefetch" href="/Blog/assets/js/24.e6bca216.js"><link rel="prefetch" href="/Blog/assets/js/26.9960f054.js"><link rel="prefetch" href="/Blog/assets/js/27.fc3fad79.js"><link rel="prefetch" href="/Blog/assets/js/28.cd83fc3d.js"><link rel="prefetch" href="/Blog/assets/js/29.443e4941.js"><link rel="prefetch" href="/Blog/assets/js/30.6a8a17b9.js"><link rel="prefetch" href="/Blog/assets/js/31.8fc47db9.js"><link rel="prefetch" href="/Blog/assets/js/32.b715a23d.js"><link rel="prefetch" href="/Blog/assets/js/33.518efbd0.js"><link rel="prefetch" href="/Blog/assets/js/34.76e7b1b1.js"><link rel="prefetch" href="/Blog/assets/js/35.f8a6b00b.js"><link rel="prefetch" href="/Blog/assets/js/36.8c12af51.js"><link rel="prefetch" href="/Blog/assets/js/37.cda5ca1d.js"><link rel="prefetch" href="/Blog/assets/js/38.60935ef0.js"><link rel="prefetch" href="/Blog/assets/js/39.26c637dd.js"><link rel="prefetch" href="/Blog/assets/js/40.44a0bfa7.js"><link rel="prefetch" href="/Blog/assets/js/41.259d1527.js"><link rel="prefetch" href="/Blog/assets/js/42.ab80d836.js"><link rel="prefetch" href="/Blog/assets/js/43.0af190a7.js"><link rel="prefetch" href="/Blog/assets/js/44.093f7743.js"><link rel="prefetch" href="/Blog/assets/js/45.8c17580f.js"><link rel="prefetch" href="/Blog/assets/js/46.fd30eace.js"><link rel="prefetch" href="/Blog/assets/js/47.214dd0f8.js"><link rel="prefetch" href="/Blog/assets/js/48.d43dc2ae.js"><link rel="prefetch" href="/Blog/assets/js/49.6136b23c.js"><link rel="prefetch" href="/Blog/assets/js/51.9fa346c5.js"><link rel="prefetch" href="/Blog/assets/js/52.6e5d9385.js"><link rel="prefetch" href="/Blog/assets/js/53.19db09c4.js">
    <link rel="stylesheet" href="/Blog/assets/css/0.styles.9ba1bd5b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Blog/" class="home-link router-link-active"><!----> <span class="site-name">å°ä¸‰èƒ–æŠ€æœ¯æ ˆ</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Blog/recondRESUME/" class="nav-link">Resume</a></div><div class="nav-item"><a href="/Blog/recondCSS/" class="nav-link">Css</a></div><div class="nav-item"><a href="/Blog/recondJAVASCRIPT/" class="nav-link">Javascript</a></div><div class="nav-item"><a href="/Blog/recondVUE/" class="nav-link router-link-active">Vue</a></div><div class="nav-item"><a href="/Blog/recondNODE/" class="nav-link">Node</a></div><div class="nav-item"><a href="/Blog/recondES6/" class="nav-link">Es6</a></div><div class="nav-item"><a href="/Blog/recondPROJECT/" class="nav-link">projectify</a></div><div class="nav-item"><a href="/Blog/recondSUMMARY/" class="nav-link">summary</a></div><div class="nav-item"><a href="/Blog/recondFEATURE/" class="nav-link">feature</a></div><div class="nav-item"><a href="/Blog/recondGIT/" class="nav-link">git</a></div><div class="nav-item"><a href="/Blog/recondOTHER/" class="nav-link">other</a></div><div class="nav-item"><a href="https://github.com/gaojingwen" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHubåœ°å€
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Blog/recondRESUME/" class="nav-link">Resume</a></div><div class="nav-item"><a href="/Blog/recondCSS/" class="nav-link">Css</a></div><div class="nav-item"><a href="/Blog/recondJAVASCRIPT/" class="nav-link">Javascript</a></div><div class="nav-item"><a href="/Blog/recondVUE/" class="nav-link router-link-active">Vue</a></div><div class="nav-item"><a href="/Blog/recondNODE/" class="nav-link">Node</a></div><div class="nav-item"><a href="/Blog/recondES6/" class="nav-link">Es6</a></div><div class="nav-item"><a href="/Blog/recondPROJECT/" class="nav-link">projectify</a></div><div class="nav-item"><a href="/Blog/recondSUMMARY/" class="nav-link">summary</a></div><div class="nav-item"><a href="/Blog/recondFEATURE/" class="nav-link">feature</a></div><div class="nav-item"><a href="/Blog/recondGIT/" class="nav-link">git</a></div><div class="nav-item"><a href="/Blog/recondOTHER/" class="nav-link">other</a></div><div class="nav-item"><a href="https://github.com/gaojingwen" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHubåœ°å€
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>Vue</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/Blog/recondVUE/" class="sidebar-link">å¤§ç¬¨è›‹</a></li><li><a href="/Blog/recondVUE/Vue.jsæœ€ä½³å®è·µäº”æ‹›è®©ä½ æˆä¸ºVue.jså¤§å¸ˆ.html" class="sidebar-link">Vue.jsæœ€ä½³å®è·µï¼ˆäº”æ‹›è®©ä½ æˆä¸ºVue.jså¤§å¸ˆï¼‰</a></li><li><a href="/Blog/recondVUE/vue2.0 é¡¹ç›®å¼€å‘å°ç»“.html" class="active sidebar-link">vue2.0 é¡¹ç›®å¼€å‘å°ç»“</a></li><li><a href="/Blog/recondVUE/ä¸€å¥— Vue çš„å•é¡µæ¨¡æ¿ï¼šN3-admin.html" class="sidebar-link">ä¸€å¥— Vue çš„å•é¡µæ¨¡æ¿ï¼šN3-admin</a></li><li><a href="/Blog/recondVUE/å½“å‰ GitHub ä¸Šæ’åå‰åçš„çƒ­é—¨ Vue é¡¹ç›®.html" class="sidebar-link">å½“å‰ GitHub ä¸Šæ’åå‰åçš„çƒ­é—¨ Vue é¡¹ç›®</a></li><li><a href="/Blog/recondVUE/æ‰‹æ‘¸æ‰‹æ•™ä½ æ­å»ºä¸€ä¸ªç±»Vueæ–‡æ¡£é£æ ¼çš„æŠ€æœ¯æ–‡æ¡£.html" class="sidebar-link">VuePress æ‰‹æ‘¸æ‰‹æ•™ä½ æ­å»ºä¸€ä¸ªç±»Vueæ–‡æ¡£é£æ ¼çš„æŠ€æœ¯æ–‡æ¡£/åšå®¢</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="vue2-0-é¡¹ç›®å¼€å‘å°ç»“"><a href="#vue2-0-é¡¹ç›®å¼€å‘å°ç»“" aria-hidden="true" class="header-anchor">#</a> vue2.0 é¡¹ç›®å¼€å‘å°ç»“</h1> <p>ç¦»å°˜ä¸ç†äºº [SegmentFault](javascript:void(0)ğŸ˜‰ <em>2017-09-11</em></p> <h4 id="é¡¹ç›®æ¶æ„"><a href="#é¡¹ç›®æ¶æ„" aria-hidden="true" class="header-anchor">#</a> é¡¹ç›®æ¶æ„</h4> <p>é¡¹ç›®ç›®å½•</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>â”œâ”€â”€ buildâ”œâ”€â”€ configâ”œâ”€â”€ distâ”‚   â””â”€â”€ staticâ”‚       â”œâ”€â”€ cssâ”‚       â”œâ”€â”€ fontsâ”‚       â”œâ”€â”€ imagesâ”‚       â”œâ”€â”€ jsâ”‚       â””â”€â”€ libâ”œâ”€â”€ srcâ”‚   â”œâ”€â”€ apiâ”‚   â”œâ”€â”€ assetsâ”‚   â”‚   â”œâ”€â”€ globalâ”‚   â”‚   â””â”€â”€ imagesâ”‚   â”‚       â””â”€â”€ footerâ”‚   â”œâ”€â”€ componentsâ”‚   â”‚   â”œâ”€â”€ commonâ”‚   â”‚   â”œâ”€â”€ newsâ”‚   â”‚   â””â”€â”€ profileâ”‚   â”‚       â””â”€â”€ chargeâ”‚   â”œâ”€â”€ configâ”‚   â”œâ”€â”€ mixinâ”‚   â”œâ”€â”€ routerâ”‚   â”œâ”€â”€ serviceâ”‚   â”œâ”€â”€ storeâ”‚   â””â”€â”€ utilâ””â”€â”€ static    â”œâ”€â”€ images    â””â”€â”€ lib 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>é¡¹ç›®ç›®å½•æ˜¯é‡‡ç”¨ <code>vue-cli</code> è‡ªåŠ¨ç”Ÿæˆï¼Œå…¶å®ƒæŒ‰éœ€è‡ªå·±æ–°å»ºå°±å¥½äº†ã€‚</p> <h4 id="å¼€å‘å®è·µ"><a href="#å¼€å‘å®è·µ" aria-hidden="true" class="header-anchor">#</a> å¼€å‘å®è·µ</h4> <p><strong>åŠ¨æ€ä¿®æ”¹ document title</strong></p> <p>åœ¨ä¸åŒçš„è·¯ç”±é¡µé¢ï¼Œæˆ‘ä»¬éœ€è¦åŠ¨æ€çš„ä¿®æ”¹æ–‡æ¡£æ ‡é¢˜ï¼Œå¯ä»¥å°†æ¯ä¸ªé¡µé¢çš„æ ‡é¢˜é…ç½®åœ¨è·¯ç”±å…ƒä¿¡æ¯ <code>meta</code> é‡Œé¢å¸¦ä¸Šï¼Œç„¶ååœ¨ <code>router.beforeEach</code> é’©å­å‡½æ•°ä¸­ä¿®æ”¹ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>import Vue from 'vue';import Router from 'vue-router';Vue.use(Router);const router = new Router({  mode: 'history',  routes: [    { path: '/', component: Index, meta: { title: 'æ¨èäº§å“å¾—ä¸°åšå¥–é‡‘' } },    {      path: '/news',      component: News,      meta: { title: 'å…¬å‘Šåˆ—è¡¨' },      children: [        { path: '', redirect: 'list' },        { path: 'list', component: NewsList },        { path: 'detail/:newsId', component: NewsDetail, meta: { title: 'å…¬å‘Šè¯¦æƒ…' } }      ]    },    {      path: '/guide',      component: GuideProtocol,      meta: {        title: 'æ–°æ‰‹æŒ‡å—'      }    }  ]});router.beforeEach((to, from, next) =&gt; {  let documentTitle = 'å•†åŸä¼šå‘˜å¹³å°';  // path æ˜¯å¤šçº§çš„ï¼Œéå†  to.matched.forEach((path) =&gt; {    if (path.meta.title) {      documentTitle += ` - ${path.meta.title}`;    }  });  document.title = documentTitle;  next();});
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>Event Bus ä½¿ç”¨åœºæ™¯</strong></p> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/aVp1YC8UV0cHx6kEIFfVV2Jo5lwyicic3pg5bicjq1iaSH7bt0mfYkBicrorUe45UutQ4kxSFMqBUBiclfq1n1kQp7qw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="img"></p> <p>æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­å¼•å…¥äº† <code>vuex</code> ï¼Œé€šå¸¸æƒ…å†µä¸‹æ˜¯ä¸éœ€è¦ä½¿ç”¨ <code>eventbus</code> çš„ï¼Œä½†æ˜¯æœ‰ä¸€ç§æƒ…å†µä¸‹æˆ‘ä»¬éœ€è¦ä½¿ç”¨å®ƒï¼Œé‚£å°±æ˜¯åœ¨è·¯ç”±é’©å­å‡½æ•°å†…éƒ¨çš„æ—¶ï¼Œåœ¨é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ <code>beforeEnter</code> è·¯ç”±é’©å­é‡Œé¢å¯¹å¤–æŠ›å‡ºäº‹ä»¶ï¼Œåœ¨è¿™ä¸ªé’©å­å‡½æ•°ä¸­æˆ‘ä»¬æ— æ³•å»åˆ° <code>this</code> å¯¹è±¡ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>beforeEnter: (to, from, next) =&gt; {    const userInfo = localStorage.getItem(userFlag);    if (isPrivateMode()) {        EventBus.$emit('get-localdata-error');        next(false);        return;    }})
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>åœ¨ <code>App.vue</code> çš„ <code>mouted</code> æ–¹æ³•ä¸­ç›‘å¬è¿™ä¸ªäº‹ä»¶</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>EventBus.$on('get-localdata-error', () =&gt; {    this.$alert('è¯·å‹¿ä½¿ç”¨æ— ç—•æ¨¡å¼æµè§ˆ');});
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>è‡ªå®šä¹‰æŒ‡ä»¤å®ç°åŸ‹ç‚¹æ•°æ®ç»Ÿè®¡</strong></p> <p>åœ¨é¡¹ç›®ä¸­é€šå¸¸éœ€è¦åšæ•°æ®åŸ‹ç‚¹ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œä½¿ç”¨è‡ªå®šä¹‰æŒ‡ä»¤å°†ä¼šå˜éå¸¸ç®€å•</p> <p>åœ¨é¡¹ç›®å…¥å£æ–‡ä»¶ <code>main.js</code> ä¸­é…ç½®æˆ‘ä»¬çš„è‡ªå®šä¹‰æŒ‡ä»¤</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// å‘ä½åŸ‹ç‚¹æŒ‡ä»¤Vue.directive('stat', {  bind(el, binding) {    el.addEventListener('click', () =&gt; {      const data = binding.value;      let prefix = 'store';      if (OS.isAndroid || OS.isPhone) {        prefix = 'mall';      }      analytics.request({        ty: `${prefix}_${data.type}`,        dc: data.desc || ''      }, 'n');    }, false);  }});
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>åœ¨ç»„ä»¶ä¸­ä½¿ç”¨æˆ‘ä»¬çš„è‡ªå®šä¹‰æŒ‡ä»¤</p> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/aVp1YC8UV0cHx6kEIFfVV2Jo5lwyicic3pzNBdN7sHXnFXU4IT1iaGRVJibLqhTYDvr0ia5PzMxRHhWCYeZWXciaETSA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="img"></p> <p><strong>ä½¿ç”¨è¿‡æ»¤å™¨å®ç°å±•ç¤ºä¿¡æ¯æ ¼å¼åŒ–</strong></p> <p>å¦‚ä¸‹å›¾ä¸­å¥–é‡‘æ•°æ®ä¿¡æ¯ï¼Œæˆ‘ä»¬éœ€è¦å°†åå°è¿”å›çš„å¥–é‡‘æ ¼å¼åŒ–ä¸ºå¸¦ä¸¤ä½å°æ•°ç‚¹çš„æ ¼å¼ï¼ŒåŒæ—¶ï¼Œå¦‚æœè¿”å›çš„é‡‘é¢æ˜¯åŒºé—´ç±»å‹ï¼Œéœ€è¦é¢å¤–åŠ ä¸Š èµ· å­—å’Œ ï¿¥ é‡‘é¢ç¬¦å·</p> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/aVp1YC8UV0cHx6kEIFfVV2Jo5lwyicic3pzNBdN7sHXnFXU4IT1iaGRVJibLqhTYDvr0ia5PzMxRHhWCYeZWXciaETSA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="img"></p> <p>åœ¨å…¥å£æ–‡ä»¶ <code>main.js</code> ä¸­é…ç½®æˆ‘ä»¬è‡ªå®šä¹‰çš„è¿‡æ»¤å™¨</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Vue.filter('money', (value, config = { unit: 'ï¿¥', fixed: 2 }) =&gt; {  const moneyStr = `${value}`;  if (moneyStr.indexOf('-') &gt; -1) {    const scope = moneyStr.split('-');    return `${config.unit}${parseFloat(scope[0]).toFixed(config.fixed).toString()} èµ·`;  } else if (value === 0) {    return value;  }  return `${config.unit}${parseFloat(moneyStr).toFixed(config.fixed).toString()}`;});
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;p class=&quot;price&quot;&gt;{{detail.priceScope | money}}&lt;/p&gt;&lt;div :class=&quot;{singleWrapper: isMobile}&quot;&gt;    &lt;p class=&quot;rate&quot;&gt;æ¯”ç‡ï¼š{{detail.commissionRateScope}}%&lt;/p&gt;    &lt;p class=&quot;income&quot;&gt;å¥–é‡‘ï¼š{{detail.expectedIncome | money}}&lt;/p&gt;&lt;/div&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>axios ä½¿ç”¨é…ç½®</strong></p> <p>åœ¨é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† axios åšæ¥å£è¯·æ±‚</p> <p>åœ¨é¡¹ç›®ä¸­å…¨å±€é…ç½® <code>/api/common.js</code></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>import axios from 'axios';import qs from 'qs';import store from '../store';// å…¨å±€é»˜è®¤é…ç½®// è®¾ç½® POST è¯·æ±‚å¤´axios.defaults.headers.post['Content-Type'] = 'application/x-www-form-urlencoded';// é…ç½® CORS è·¨åŸŸaxios.defaults.withCredentials = true;axios.defaults.crossDomain = true;// è¯·æ±‚å‘èµ·å‰æ‹¦æˆªå™¨axios.interceptors.request.use((config) =&gt; {  // å…¨å±€ loading çŠ¶æ€ï¼Œè§¦å‘ loading æ•ˆæœ  store.dispatch('updateLoadingStatus', {    isLoading: true  });  // POST è¯·æ±‚å‚æ•°å¤„ç†æˆ axios post æ–¹æ³•æ‰€éœ€çš„æ ¼å¼  if (config.method === 'post') {    config.data = qs.stringify(config.data);  }  // è¿™å¥ä¸èƒ½çœï¼Œä¸ç„¶åé¢çš„è¯·æ±‚å°±æ— æ³•æˆåŠŸå‘èµ·ï¼Œå› ä¸ºè¯»ä¸åˆ°é…ç½®å‚æ•°  return config;}, () =&gt; {  // å¼‚å¸¸å¤„ç†  store.dispatch('updateLoadingStatus', {    isLoading: false  });});// å“åº”æ‹¦æˆªaxios.interceptors.response.use((response) =&gt; {  // å…³é—­ loading æ•ˆæœ  store.dispatch('updateLoadingStatus', {    isLoading: false  });  // å…¨å±€ç™»å½•è¿‡æ»¤ï¼Œå¦‚æœæ²¡æœ‰ç™»å½•ï¼Œç›´æ¥è·³è½¬åˆ°ç™»å½• URL  if (response.data.code === 300) {    // æœªç™»å½•    window.location.href = getLoginUrl();    return false;  }  // è¿™é‡Œè¿”å›çš„ response.data æ˜¯è¢« axios åŒ…è£…è¿‡çš„ä¸€æˆï¼Œæ‰€ä»¥åœ¨è¿™é‡ŒæŠ½å–å‡ºæ¥  return response.data;}, (error) =&gt; {  store.dispatch('updateLoadingStatus', {    isLoading: false  });  return Promise.reject(error);});// å¯¼å‡ºexport default axios;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>ç„¶åæˆ‘ä»¬åœ¨æ¥å£ä¸­ä½¿ç”¨å°±æ–¹ä¾¿å¾ˆå¤šäº† <code>/api/xxx.js</code></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>import axios from './common';const baseURL = '/api/profile';const USER_BASE_INFO = `${baseURL}/getUserBaseInfo.json`;const UPDATE_USER_INFO = `${baseURL}/saveUserInfo.json`;// æ›´æ–°ç”¨æˆ·å®åè®¤è¯ä¿¡æ¯const updateUserInfo = userinfo =&gt; axios.post(UPDATE_USER_INFO, userinfo);// è·å–ç”¨æˆ·åŸºç¡€ä¿¡æ¯const getUserBaseInfo = () =&gt; axios.get(USER_BASE_INFO);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>vuex çŠ¶æ€åœ¨å“åº”å¼é¡µé¢ä¸­çš„å¦™ç”¨</strong></p> <p>ç”±äºé¡¹ç›®æ˜¯å“åº”å¼é¡µé¢ï¼ŒPC ç«¯å’Œç§»åŠ¨ç«¯åœ¨è¡¨ç°æˆæœ‰å¾ˆå¤šä¸ä¸€è‡´çš„åœ°æ–¹ï¼Œæœ‰æ—¶å€™å•å•é€šè¿‡ CSS æ— æ³•å®ç°äº¤äº’ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬çš„ <code>vuex</code> çŠ¶æ€å°±æ´¾ä¸Šç”¨åœºäº†ï¼Œ</p> <p>æˆ‘ä»¬ä¸€å¼€å§‹åœ¨ <code>App.vue</code> é‡Œé¢ç›‘å¬äº†é¡µé¢çš„ <code>resize</code> äº‹ä»¶ï¼ŒåŠ¨æ€çš„æ›´æ–° <code>vuex</code> é‡Œé¢ <code>isMobile</code>çš„çŠ¶æ€å€¼</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>window.onresize = throttle(() =&gt; { this.updatePlatformStatus({   isMobile: isMobile() });}, 500);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>ç„¶åï¼Œæˆ‘ä»¬åœ¨ç»„ä»¶å±‚ï¼Œå°±èƒ½å“åº”å¼çš„æ¸²æŸ“ä¸åŒçš„ <code>dom</code> ç»“æ„äº†ã€‚å…¶ä¸­æœ€å¸¸è§çš„æ˜¯ PC ç«¯å’Œç§»åŠ¨ç«¯åŠ è½½çš„å›¾ç‰‡éœ€è¦ä¸åŒçš„è§„æ ¼çš„ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥è¿™ä¸ªåš</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>methods: {  loadImgAssets(name, suffix = '.jpg') {    return require(`../assets/images/${name}${this.isMobile ? '-mobile' : ''}${suffix}`);  },}&lt;img class=&quot;feed-back&quot; :src=&quot;loadImgAssets('feed-back')&quot;&lt;img v-lazy=&quot;{src: isMobile ? detail.imgUrlMobile : detail.imgUrlPc, loading: placeholder}&quot;&gt;// åŠ¨æ€æ¸²æŸ“ä¸åŒè§„æ ¼çš„ dislog&lt;el-dialog :visible.sync=&quot;dialogVisible&quot; :size=&quot;isMobile ? 'full' : 'tiny'&quot; top=&quot;30%&quot; custom-class=&quot;unCertification-dialog&quot;&gt;&lt;/el-dialog&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>ä¸‹å›¾åˆ†åˆ«æ˜¯ PC ç«¯å’Œç§»åŠ¨çŸ­çš„è¡¨ç°å½¢å¼ï¼Œç„¶åé…åˆ CSS åª’ä½“æŸ¥è¯¢å®ç°å„ç§å¸ƒå±€</p> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/aVp1YC8UV0cHx6kEIFfVV2Jo5lwyicic3pmib4BBBHvxQnfQDXWx2UQJ6W8ib5wibDHPvNwN1R6hGPgPX8wHdbUM3YA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="img"></p> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/aVp1YC8UV0cHx6kEIFfVV2Jo5lwyicic3p8lbYhfTpia3HI7EKjxwDvfAgvjKmkO3WYQrmUSNLd4y6WnZXATyM2pQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="img"></p> <p>å¼€å‘ç›¸å…³é…ç½®</p> <p><strong>åå‘ä»£ç†</strong></p> <p>åœ¨é¡¹ç›®ç›®å½•çš„ <code>config</code> æ–‡ä»¶ä¸‹é¢çš„ <code>index.js</code> é…ç½®æˆ‘ä»¬çš„æœ¬åœ°åå‘ä»£ç†å’Œç«¯å£ä¿¡æ¯</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>dev: {  env: require('./dev.env'),  port: 80,  autoOpenBrowser: true,  assetsSubDirectory: 'static',  assetsPublicPath: '/',  proxyTable: {    '/api/profile': {      target: '[çœŸå®æ¥å£åœ°å€]:[ç«¯å£å·]', // ä¾‹å¦‚ï¼š http://api.xxx.com      changeOrigin: true,      pathRewrite: {        '^/api/profile': '/profile'      }    }    ...  },
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>ç„¶åæˆ‘ä»¬è°ƒç”¨æ¥å£çš„å½¢å¼å°±ä¼šå˜æˆå¦‚ä¸‹æ˜ å°„ï¼Œå½“æˆ‘ä»¬è°ƒç”¨ <code>/api/profile/xxxx</code> çš„æ—¶å€™ï¼Œå…¶å®æ˜¯è°ƒç”¨äº† <code>[çœŸå®æ¥å£åœ°å€]/profile/xxxx</code></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>/api/profile/xxxx =&gt; [çœŸå®æ¥å£åœ°å€]/profile/xxxx
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>nginx é…ç½®</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>upstream api.xxx.com{ #ip_hash;  server [æ¥å£æœåŠ¡å™¨ ip åœ°å€]:[ç«¯å£];}server {  ...  location ^~ /api/profile {    index index.php index.html index.html;    proxy_redirect off;    proxy_set_header Host $host;    proxy_set_header X-Real-IP $remote_addr;    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;    proxy_pass http://api.xxx.com;    rewrite ^/api/profile/(.*)$ /profile/$1 break;  }  ...}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>çº¿ä¸Šéƒ¨ç½²</strong></p> <p>å¦‚æœè·¯ç”±ä½¿ç”¨çš„æ˜¯ <code>history</code> æ¨¡å¼çš„è¯ï¼Œéœ€è¦åœ¨ <code>nginx</code> é‡Œé¢é…ç½®å°†æ‰€æœ‰çš„è¯·æ±‚åˆ°è½¬å‘åˆ° <code>index.html</code> å»</p> <p>åœ¨ <code>nginx.conf</code> æˆ–è€…å¯¹åº”çš„ç«™ç‚¹ <code>vhost</code> æ–‡ä»¶ä¸‹é¢é…ç½®</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>location / {    try_files $uri $uri/ /index.html;}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="ä¼˜åŒ–"><a href="#ä¼˜åŒ–" aria-hidden="true" class="header-anchor">#</a> ä¼˜åŒ–</h4> <p><strong>å¼€å¯é™æ€èµ„æºé•¿ç¼“å­˜</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>location ~ .*\.(gif|jpg|jpeg|png|bmp|swf|woff|ttf|eot|svg)$ {    expires 1y;}location ~ .*\.(js|css)$ {    expires 1y;}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>å¼€å¯é™æ€èµ„æº gzip å‹ç¼©</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// æ‰¾åˆ° nginx.conf é…ç½®æ–‡ä»¶vim /data/nginx/conf/nginx.confgzip on;gzip_min_length  1k;gzip_buffers     4 8k;gzip_http_version 1.1;gzip_types text/plain application/javascript application/x-javascript text/javascript text/xml text/css;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>å¼€å¯äº† gzip å‹ç¼©ä¹‹åï¼Œé¡µé¢èµ„æºè¯·æ±‚å¤§å°å°†å¤§å¤§å‡å°ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè¡¨ç¤ºå·²ç»å¼€å¯äº† <code>gzip</code>å‹ç¼©</p> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/aVp1YC8UV0cHx6kEIFfVV2Jo5lwyicic3pxBIBMrFYgJrpicialrfhgEhhDiarpzWibLBKXJdvONyt6ajFgjXLicqL9ibQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="img"></p> <h4 id="q-a"><a href="#q-a" aria-hidden="true" class="header-anchor">#</a> Q&amp;A</h4> <p>æ–‡ç« åˆ°è¿™å°±ç»“æŸäº†ï¼Œå¦‚æœæœ‰é—æ¼æˆ–è€…é”™è¯¯çš„åœ°æ–¹ï¼Œæ¬¢è¿ç§ä¿¡æŒ‡å‡ºã€‚å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¸¦ç»™å¤§å®¶ä¸€ä¸ä¸æ”¶è·ã€‚</p> <hr></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">9/17/2018, 5:48:19 PM</span></div></div> <!----> </div> <!----></div></div>
    <script src="/Blog/assets/js/50.fd4e81e2.js" defer></script><script src="/Blog/assets/js/app.b624378b.js" defer></script>
  </body>
</html>
